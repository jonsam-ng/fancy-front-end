<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆä¸ƒï¼‰ | Fancy Front End</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/assets/img/favicon.ico">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3314748_9xij1pv3h4i.css">
    <meta name="description" content="å‰ç«¯æºç é˜…è¯»æ ˆï¼Œç²¾è¯» Reactã€Vue3 æºç ">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="keywords" content="å‰ç«¯æºç ,Reactæºç ,Vueæºç ,Vu3æºç ,Webpackæºç ">
    <meta name="theme-color" content="#3CB982">
    
    <link rel="preload" href="/assets/css/0.styles.e2349a00.css" as="style"><link rel="preload" href="/assets/js/app.eb21b6ee.js" as="script"><link rel="preload" href="/assets/js/2.01e091c2.js" as="script"><link rel="preload" href="/assets/js/54.5d7f6427.js" as="script"><link rel="preload" href="/assets/js/4.54e60667.js" as="script"><link rel="preload" href="/assets/js/12.71337abb.js" as="script"><link rel="preload" href="/assets/js/10.ac472f43.js" as="script"><link rel="preload" href="/assets/js/11.c50183f9.js" as="script"><link rel="preload" href="/assets/js/8.7cbef5ec.js" as="script"><link rel="preload" href="/assets/js/5.f620477b.js" as="script"><link rel="prefetch" href="/assets/js/100.8081075e.js"><link rel="prefetch" href="/assets/js/101.943ea683.js"><link rel="prefetch" href="/assets/js/102.11c8554c.js"><link rel="prefetch" href="/assets/js/103.c2780521.js"><link rel="prefetch" href="/assets/js/104.81994794.js"><link rel="prefetch" href="/assets/js/105.f987244b.js"><link rel="prefetch" href="/assets/js/106.235a578e.js"><link rel="prefetch" href="/assets/js/107.94cdbb18.js"><link rel="prefetch" href="/assets/js/108.3a80cb29.js"><link rel="prefetch" href="/assets/js/109.8884be03.js"><link rel="prefetch" href="/assets/js/110.89ab5eb2.js"><link rel="prefetch" href="/assets/js/111.355b1782.js"><link rel="prefetch" href="/assets/js/112.34671c87.js"><link rel="prefetch" href="/assets/js/113.0cca0902.js"><link rel="prefetch" href="/assets/js/114.01616168.js"><link rel="prefetch" href="/assets/js/115.4915c0b5.js"><link rel="prefetch" href="/assets/js/116.ef93855a.js"><link rel="prefetch" href="/assets/js/117.e3526ed0.js"><link rel="prefetch" href="/assets/js/118.7d52a4ea.js"><link rel="prefetch" href="/assets/js/119.a4bb17bb.js"><link rel="prefetch" href="/assets/js/120.135aa6ea.js"><link rel="prefetch" href="/assets/js/121.86c35c15.js"><link rel="prefetch" href="/assets/js/122.1452986d.js"><link rel="prefetch" href="/assets/js/123.0181b553.js"><link rel="prefetch" href="/assets/js/124.edc508f8.js"><link rel="prefetch" href="/assets/js/125.46d932c1.js"><link rel="prefetch" href="/assets/js/126.17e05a12.js"><link rel="prefetch" href="/assets/js/127.98159dfe.js"><link rel="prefetch" href="/assets/js/128.9aaa5bc6.js"><link rel="prefetch" href="/assets/js/129.26bed928.js"><link rel="prefetch" href="/assets/js/13.292db5f6.js"><link rel="prefetch" href="/assets/js/130.9f74c846.js"><link rel="prefetch" href="/assets/js/131.d6ef0885.js"><link rel="prefetch" href="/assets/js/132.1d9ee075.js"><link rel="prefetch" href="/assets/js/133.2b23ed7b.js"><link rel="prefetch" href="/assets/js/134.c47e8a23.js"><link rel="prefetch" href="/assets/js/135.2aeb3426.js"><link rel="prefetch" href="/assets/js/136.0169c47b.js"><link rel="prefetch" href="/assets/js/137.70cdfc24.js"><link rel="prefetch" href="/assets/js/138.e54160ee.js"><link rel="prefetch" href="/assets/js/139.9a6d1932.js"><link rel="prefetch" href="/assets/js/14.54d2636a.js"><link rel="prefetch" href="/assets/js/140.ddabaeca.js"><link rel="prefetch" href="/assets/js/141.35844ecc.js"><link rel="prefetch" href="/assets/js/142.4ccdb5e4.js"><link rel="prefetch" href="/assets/js/143.37a7f36e.js"><link rel="prefetch" href="/assets/js/144.95ff6a63.js"><link rel="prefetch" href="/assets/js/145.9899e545.js"><link rel="prefetch" href="/assets/js/146.6865658b.js"><link rel="prefetch" href="/assets/js/147.2a55d18a.js"><link rel="prefetch" href="/assets/js/148.f3aab640.js"><link rel="prefetch" href="/assets/js/149.57b565a0.js"><link rel="prefetch" href="/assets/js/15.81d908ff.js"><link rel="prefetch" href="/assets/js/150.3f7143ae.js"><link rel="prefetch" href="/assets/js/151.5981cf9e.js"><link rel="prefetch" href="/assets/js/152.a3428a7b.js"><link rel="prefetch" href="/assets/js/153.0f0b339d.js"><link rel="prefetch" href="/assets/js/154.39f3b522.js"><link rel="prefetch" href="/assets/js/155.13c8170a.js"><link rel="prefetch" href="/assets/js/156.ccb66614.js"><link rel="prefetch" href="/assets/js/157.4b8bce50.js"><link rel="prefetch" href="/assets/js/158.6476dd1c.js"><link rel="prefetch" href="/assets/js/159.b261a009.js"><link rel="prefetch" href="/assets/js/16.68d8e787.js"><link rel="prefetch" href="/assets/js/160.e501007d.js"><link rel="prefetch" href="/assets/js/161.d3f56d3d.js"><link rel="prefetch" href="/assets/js/162.f8590797.js"><link rel="prefetch" href="/assets/js/163.91fe4509.js"><link rel="prefetch" href="/assets/js/164.6e92f3f4.js"><link rel="prefetch" href="/assets/js/165.56868a39.js"><link rel="prefetch" href="/assets/js/166.83812a3b.js"><link rel="prefetch" href="/assets/js/167.4b528df4.js"><link rel="prefetch" href="/assets/js/168.f2b151fb.js"><link rel="prefetch" href="/assets/js/169.cb2ee128.js"><link rel="prefetch" href="/assets/js/17.895175dc.js"><link rel="prefetch" href="/assets/js/170.63b574e9.js"><link rel="prefetch" href="/assets/js/171.ad38a311.js"><link rel="prefetch" href="/assets/js/172.b592b97e.js"><link rel="prefetch" href="/assets/js/173.302ef08b.js"><link rel="prefetch" href="/assets/js/174.d71ad1a3.js"><link rel="prefetch" href="/assets/js/175.2617c860.js"><link rel="prefetch" href="/assets/js/176.19a67035.js"><link rel="prefetch" href="/assets/js/177.75aab37d.js"><link rel="prefetch" href="/assets/js/178.b2773712.js"><link rel="prefetch" href="/assets/js/179.6a34b45f.js"><link rel="prefetch" href="/assets/js/18.736b781d.js"><link rel="prefetch" href="/assets/js/180.d447fc48.js"><link rel="prefetch" href="/assets/js/181.d6b96886.js"><link rel="prefetch" href="/assets/js/182.42c2bcd5.js"><link rel="prefetch" href="/assets/js/183.a6256a82.js"><link rel="prefetch" href="/assets/js/184.8a036f5a.js"><link rel="prefetch" href="/assets/js/185.811d5831.js"><link rel="prefetch" href="/assets/js/186.6436a583.js"><link rel="prefetch" href="/assets/js/187.4bcf94a3.js"><link rel="prefetch" href="/assets/js/188.33f39bd6.js"><link rel="prefetch" href="/assets/js/189.c1b90840.js"><link rel="prefetch" href="/assets/js/19.504bd141.js"><link rel="prefetch" href="/assets/js/20.e526fb51.js"><link rel="prefetch" href="/assets/js/21.8375d39e.js"><link rel="prefetch" href="/assets/js/22.0e15b626.js"><link rel="prefetch" href="/assets/js/23.83bcc15c.js"><link rel="prefetch" href="/assets/js/24.3df554ce.js"><link rel="prefetch" href="/assets/js/25.6c56da2b.js"><link rel="prefetch" href="/assets/js/26.76154857.js"><link rel="prefetch" href="/assets/js/27.155dbcb4.js"><link rel="prefetch" href="/assets/js/28.7178e96c.js"><link rel="prefetch" href="/assets/js/29.f7337396.js"><link rel="prefetch" href="/assets/js/3.50570587.js"><link rel="prefetch" href="/assets/js/30.191545d3.js"><link rel="prefetch" href="/assets/js/31.b6a0fe90.js"><link rel="prefetch" href="/assets/js/32.18cebeab.js"><link rel="prefetch" href="/assets/js/33.146782c3.js"><link rel="prefetch" href="/assets/js/34.c08af9cb.js"><link rel="prefetch" href="/assets/js/35.ea730de0.js"><link rel="prefetch" href="/assets/js/36.11aba0b0.js"><link rel="prefetch" href="/assets/js/37.0fd8e20a.js"><link rel="prefetch" href="/assets/js/38.2cde6902.js"><link rel="prefetch" href="/assets/js/39.07c230cc.js"><link rel="prefetch" href="/assets/js/40.e4fcccd0.js"><link rel="prefetch" href="/assets/js/41.5f96c201.js"><link rel="prefetch" href="/assets/js/42.e5023440.js"><link rel="prefetch" href="/assets/js/43.2cfdc8d9.js"><link rel="prefetch" href="/assets/js/44.37f32c52.js"><link rel="prefetch" href="/assets/js/45.3973ea4b.js"><link rel="prefetch" href="/assets/js/46.87541312.js"><link rel="prefetch" href="/assets/js/47.04f0011f.js"><link rel="prefetch" href="/assets/js/48.1151f311.js"><link rel="prefetch" href="/assets/js/49.6830fb0c.js"><link rel="prefetch" href="/assets/js/50.84b34574.js"><link rel="prefetch" href="/assets/js/51.840f38c4.js"><link rel="prefetch" href="/assets/js/52.3dbda6e7.js"><link rel="prefetch" href="/assets/js/53.7f0a8896.js"><link rel="prefetch" href="/assets/js/55.86c7b544.js"><link rel="prefetch" href="/assets/js/56.49a27b9a.js"><link rel="prefetch" href="/assets/js/57.287f9e58.js"><link rel="prefetch" href="/assets/js/58.40a49fdb.js"><link rel="prefetch" href="/assets/js/59.91487422.js"><link rel="prefetch" href="/assets/js/6.8880bb8c.js"><link rel="prefetch" href="/assets/js/60.8dfd58ee.js"><link rel="prefetch" href="/assets/js/61.7b4874b9.js"><link rel="prefetch" href="/assets/js/62.d83f3691.js"><link rel="prefetch" href="/assets/js/63.1237a900.js"><link rel="prefetch" href="/assets/js/64.1f096a25.js"><link rel="prefetch" href="/assets/js/65.809d988d.js"><link rel="prefetch" href="/assets/js/66.43c1e5f9.js"><link rel="prefetch" href="/assets/js/67.24ab137d.js"><link rel="prefetch" href="/assets/js/68.7b0346b5.js"><link rel="prefetch" href="/assets/js/69.2008c989.js"><link rel="prefetch" href="/assets/js/7.0c293177.js"><link rel="prefetch" href="/assets/js/70.e8cf3232.js"><link rel="prefetch" href="/assets/js/71.d661943d.js"><link rel="prefetch" href="/assets/js/72.e67a47a3.js"><link rel="prefetch" href="/assets/js/73.87f1db52.js"><link rel="prefetch" href="/assets/js/74.ac67cd0d.js"><link rel="prefetch" href="/assets/js/75.e25ebf69.js"><link rel="prefetch" href="/assets/js/76.a7222468.js"><link rel="prefetch" href="/assets/js/77.ffb71305.js"><link rel="prefetch" href="/assets/js/78.72c00bee.js"><link rel="prefetch" href="/assets/js/79.66ec368e.js"><link rel="prefetch" href="/assets/js/80.8792d3d7.js"><link rel="prefetch" href="/assets/js/81.49d3731a.js"><link rel="prefetch" href="/assets/js/82.fbe09e61.js"><link rel="prefetch" href="/assets/js/83.220a02bb.js"><link rel="prefetch" href="/assets/js/84.4b722410.js"><link rel="prefetch" href="/assets/js/85.f83d2db9.js"><link rel="prefetch" href="/assets/js/86.17b19d53.js"><link rel="prefetch" href="/assets/js/87.37568307.js"><link rel="prefetch" href="/assets/js/88.d7cc6612.js"><link rel="prefetch" href="/assets/js/89.ffb378d0.js"><link rel="prefetch" href="/assets/js/9.2a7e5bdc.js"><link rel="prefetch" href="/assets/js/90.02c91127.js"><link rel="prefetch" href="/assets/js/91.c22d9224.js"><link rel="prefetch" href="/assets/js/92.c79d457a.js"><link rel="prefetch" href="/assets/js/93.33a03732.js"><link rel="prefetch" href="/assets/js/94.c73ddbbc.js"><link rel="prefetch" href="/assets/js/95.a5151497.js"><link rel="prefetch" href="/assets/js/96.b8f204d2.js"><link rel="prefetch" href="/assets/js/97.d7ddaa6f.js"><link rel="prefetch" href="/assets/js/98.49dbda5e.js"><link rel="prefetch" href="/assets/js/99.d14f43ad.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e2349a00.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="Fancy Front End" class="logo"> <span class="site-name can-hide">Fancy Front End</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Reactæºç " class="dropdown-title"><a href="/react/index/" class="link-title">Reactæºç </a> <span class="title" style="display:none;">Reactæºç </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/index/" class="nav-link">å¼€å§‹ä¸Šæ‰‹</a></li><li class="dropdown-item"><!----> <a href="/react/basic/index/" class="nav-link">åŸºç¡€</a></li><li class="dropdown-item"><!----> <a href="/react/scheduler/index/" class="nav-link">è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰</a></li><li class="dropdown-item"><!----> <a href="/react/updater/index/" class="nav-link">æ›´æ–°å™¨ï¼ˆUpdaterï¼‰</a></li><li class="dropdown-item"><!----> <a href="/react/render/index/" class="nav-link">æ¸²æŸ“å™¨ï¼ˆRenderï¼‰</a></li><li class="dropdown-item"><!----> <a href="/react/update/index/" class="nav-link">æ›´æ–°å‘¨æœŸ</a></li><li class="dropdown-item"><!----> <a href="/react/hooks/index/" class="nav-link">hooks åŸç†</a></li><li class="dropdown-item"><!----> <a href="/react/summary/index/" class="nav-link">æ€»ç»“</a></li><li class="dropdown-item"><!----> <a href="/react/tour/index/" class="nav-link">ğŸ“™ Reactæºç æ¼‚æµè®°</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue3æºç " class="dropdown-title"><a href="/vue3/index/" class="link-title">Vue3æºç </a> <span class="title" style="display:none;">Vue3æºç </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/index/" class="nav-link">å¼€å§‹ä¸Šæ‰‹</a></li><li class="dropdown-item"><!----> <a href="/vue3/basic/index/" class="nav-link">åŸºç¡€</a></li><li class="dropdown-item"><!----> <a href="/vue3/reactivity/index/" class="nav-link">reactivity</a></li><li class="dropdown-item"><!----> <a href="/vue3/runtime-core/index/" class="nav-link">runtime-core</a></li><li class="dropdown-item"><!----> <a href="/vue3/runtime-dom/index/" class="nav-link">runtime-dom</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è¿›é˜¶" class="dropdown-title"><a href="/web/" class="link-title">è¿›é˜¶</a> <span class="title" style="display:none;">è¿›é˜¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/" class="nav-link">Awesome Web</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">Awesome NodeJS</a></li></ul></div></div><div class="nav-item"><a href="/topic/" class="nav-link">è¯é¢˜</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ›´å¤š" class="dropdown-title"><a href="/nav/" class="link-title">æ›´å¤š</a> <span class="title" style="display:none;">æ›´å¤š</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nav/" class="nav-link">å¯¼èˆª</a></li><li class="dropdown-item"><!----> <a href="/qa/" class="nav-link">Q&amp;A</a></li><li class="dropdown-item"><!----> <a href="/slides/#/1" class="nav-link">å¹»ç¯ç‰‡</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">å…³äº</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://www.jonsam.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/jonsam-ng/fancy-front-end" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/oxygen-space/image.5a0lthv367k0.png"> <div class="blogger-info"><h3>Jonsam NG</h3> <span>è®©æœ‰æ„ä¹‰çš„äº‹å˜å¾—æœ‰æ„æ€ï¼Œè®©æœ‰æ„æ€çš„äº‹å˜å¾—æœ‰æ„ä¹‰</span></div></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Reactæºç " class="dropdown-title"><a href="/react/index/" class="link-title">Reactæºç </a> <span class="title" style="display:none;">Reactæºç </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/index/" class="nav-link">å¼€å§‹ä¸Šæ‰‹</a></li><li class="dropdown-item"><!----> <a href="/react/basic/index/" class="nav-link">åŸºç¡€</a></li><li class="dropdown-item"><!----> <a href="/react/scheduler/index/" class="nav-link">è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰</a></li><li class="dropdown-item"><!----> <a href="/react/updater/index/" class="nav-link">æ›´æ–°å™¨ï¼ˆUpdaterï¼‰</a></li><li class="dropdown-item"><!----> <a href="/react/render/index/" class="nav-link">æ¸²æŸ“å™¨ï¼ˆRenderï¼‰</a></li><li class="dropdown-item"><!----> <a href="/react/update/index/" class="nav-link">æ›´æ–°å‘¨æœŸ</a></li><li class="dropdown-item"><!----> <a href="/react/hooks/index/" class="nav-link">hooks åŸç†</a></li><li class="dropdown-item"><!----> <a href="/react/summary/index/" class="nav-link">æ€»ç»“</a></li><li class="dropdown-item"><!----> <a href="/react/tour/index/" class="nav-link">ğŸ“™ Reactæºç æ¼‚æµè®°</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue3æºç " class="dropdown-title"><a href="/vue3/index/" class="link-title">Vue3æºç </a> <span class="title" style="display:none;">Vue3æºç </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/index/" class="nav-link">å¼€å§‹ä¸Šæ‰‹</a></li><li class="dropdown-item"><!----> <a href="/vue3/basic/index/" class="nav-link">åŸºç¡€</a></li><li class="dropdown-item"><!----> <a href="/vue3/reactivity/index/" class="nav-link">reactivity</a></li><li class="dropdown-item"><!----> <a href="/vue3/runtime-core/index/" class="nav-link">runtime-core</a></li><li class="dropdown-item"><!----> <a href="/vue3/runtime-dom/index/" class="nav-link">runtime-dom</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è¿›é˜¶" class="dropdown-title"><a href="/web/" class="link-title">è¿›é˜¶</a> <span class="title" style="display:none;">è¿›é˜¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/" class="nav-link">Awesome Web</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">Awesome NodeJS</a></li></ul></div></div><div class="nav-item"><a href="/topic/" class="nav-link">è¯é¢˜</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ›´å¤š" class="dropdown-title"><a href="/nav/" class="link-title">æ›´å¤š</a> <span class="title" style="display:none;">æ›´å¤š</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nav/" class="nav-link">å¯¼èˆª</a></li><li class="dropdown-item"><!----> <a href="/qa/" class="nav-link">Q&amp;A</a></li><li class="dropdown-item"><!----> <a href="/slides/#/1" class="nav-link">å¹»ç¯ç‰‡</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">å…³äº</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://www.jonsam.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/jonsam-ng/fancy-front-end" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/react/index/" class="sidebar-link">å¼€å§‹ä¸Šæ‰‹</a></li><li><a href="/react/plan/" class="sidebar-link">plan è®¡åˆ’</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>åŸºç¡€</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>è°ƒå’Œï¼ˆReconciliationï¼‰</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ›´æ–°å™¨ï¼ˆUpdaterï¼‰</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ¸²æŸ“å™¨ï¼ˆRenderï¼‰</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>hooksåŸç†</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ€»ç»“</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Reactæºç æ¼‚æµè®°</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/tour/index/" class="sidebar-link">å¼€å§‹ä¸Šæ‰‹</a></li><li><a href="/react/tour/plan/" class="sidebar-link">Plan è®¡åˆ’</a></li><li><a href="/react/tour/talk/" class="sidebar-link">å‰è¨€</a></li><li><a href="/react/tour/react-basic-element/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReactElement ä¸åŸºç¡€æ¦‚å¿µ</a></li><li><a href="/react/tour/react-basic-children/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReactChildren ä¸èŠ‚ç‚¹æ“çºµ</a></li><li><a href="/react/tour/react-basic-glimpse/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReact æ•´ä½“ç»“æ„å’Œç†å¿µåˆè®¤è¯†</a></li><li><a href="/react/tour/react-reconciliation-1/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆä¸€ï¼‰</a></li><li><a href="/react/tour/react-reconciliation-2/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆäºŒï¼‰</a></li><li><a href="/react/tour/react-reconciliation-3/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆä¸‰ï¼‰</a></li><li><a href="/react/tour/react-reconciliation-4/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆå››ï¼‰</a></li><li><a href="/react/tour/react-reconciliation-5/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆäº”ï¼‰</a></li><li><a href="/react/tour/react-reconciliation-6/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆå…­ï¼‰</a></li><li><a href="/react/tour/react-reconciliation-7/" aria-current="page" class="active sidebar-link">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆä¸ƒï¼‰</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/react/tour/react-reconciliation-7/#ç›®å½•" class="sidebar-link">ç›®å½•</a></li><li class="sidebar-sub-header level2"><a href="/react/tour/react-reconciliation-7/#å‰è¨€" class="sidebar-link">å‰è¨€</a></li><li class="sidebar-sub-header level2"><a href="/react/tour/react-reconciliation-7/#finishconcurrentrender" class="sidebar-link">finishConcurrentRender</a></li><li class="sidebar-sub-header level2"><a href="/react/tour/react-reconciliation-7/#commitroot" class="sidebar-link">commitRoot</a></li><li class="sidebar-sub-header level2"><a href="/react/tour/react-reconciliation-7/#effectlist-çš„éå†" class="sidebar-link">EffectList çš„éå†</a></li><li class="sidebar-sub-header level2"><a href="/react/tour/react-reconciliation-7/#commitbeforemutationeffects" class="sidebar-link">commitBeforeMutationEffects</a></li><li class="sidebar-sub-header level2"><a href="/react/tour/react-reconciliation-7/#commitmutationeffects" class="sidebar-link">commitMutationEffects</a></li><li class="sidebar-sub-header level2"><a href="/react/tour/react-reconciliation-7/#commitlayouteffects" class="sidebar-link">commitLayoutEffects</a></li><li class="sidebar-sub-header level2"><a href="/react/tour/react-reconciliation-7/#æ‰©å±•" class="sidebar-link">æ‰©å±•</a></li><li class="sidebar-sub-header level2"><a href="/react/tour/react-reconciliation-7/#é—®é¢˜" class="sidebar-link">é—®é¢˜</a></li><li class="sidebar-sub-header level2"><a href="/react/tour/react-reconciliation-7/#æ€»ç»“" class="sidebar-link">æ€»ç»“</a></li><li class="sidebar-sub-header level2"><a href="/react/tour/react-reconciliation-7/#å‚è€ƒ" class="sidebar-link">å‚è€ƒ</a></li></ul></li><li><a href="/react/tour/react-reconciliation-8/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆå…«ï¼‰</a></li><li><a href="/react/tour/react-reconciliation-9/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆä¹ï¼‰</a></li><li><a href="/react/tour/react-reconciliation-10/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆåï¼‰</a></li><li><a href="/react/tour/react-scheduler-1/" class="sidebar-link">React æºç æ¼‚æµè®°ï¼šReact è°ƒåº¦å™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆä¸€ï¼‰</a></li><li><a href="/react/tour/dr-1/" class="sidebar-link">å¸¦ç€åŸç†é‡è¯» React å®˜æ–¹æ–‡æ¡£ï¼ˆä¸€ï¼‰</a></li><li><a href="/react/tour/dr-2/" class="sidebar-link">å¸¦ç€åŸç†é‡è¯» React å®˜æ–¹æ–‡æ¡£ï¼ˆäºŒï¼‰</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-e1efabd0><div class="articleInfo" data-v-e1efabd0><ul class="breadcrumbs" data-v-e1efabd0><li data-v-e1efabd0><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-e1efabd0></a></li> <li data-v-e1efabd0><a href="/categories/?category=react" title="åˆ†ç±»" data-v-e1efabd0>react</a></li><li data-v-e1efabd0><a href="/categories/?category=React%E6%BA%90%E7%A0%81%E6%BC%82%E6%B5%81%E8%AE%B0" title="åˆ†ç±»" data-v-e1efabd0>Reactæºç æ¼‚æµè®°</a></li></ul> <div class="info" data-v-e1efabd0><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-e1efabd0><a href="https://github.com/jonsam-ng" target="_blank" title="ä½œè€…" class="beLink" data-v-e1efabd0>jonsam</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-e1efabd0><a href="javascript:;" data-v-e1efabd0>2022-08-01</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆä¸ƒï¼‰<!----></h1>  <div class="theme-vdoing-content content__default"><div class="badge-group" data-v-ac1337e0><span class="group-tag" data-v-ac1337e0>æ ‡ç­¾ï¼š</span> <span class="badge tip" style="vertical-align:top;" data-v-ac1337e0 data-v-4f7c9f45>React17</span><span class="badge tip" style="vertical-align:top;" data-v-ac1337e0 data-v-4f7c9f45>ç²¾ç®€</span></div> <!----> <h2 id="ç›®å½•"><a href="#ç›®å½•" class="header-anchor">#</a> ç›®å½•</h2> <p></p><div class="table-of-contents"><ul><li><a href="#ç›®å½•">ç›®å½•</a></li><li><a href="#å‰è¨€">å‰è¨€</a></li><li><a href="#finishconcurrentrender">finishConcurrentRender</a></li><li><a href="#commitroot">commitRoot</a></li><li><a href="#effectlist-çš„éå†">EffectList çš„éå†</a></li><li><a href="#commitbeforemutationeffects">commitBeforeMutationEffects</a></li><li><a href="#commitmutationeffects">commitMutationEffects</a></li><li><a href="#commitlayouteffects">commitLayoutEffects</a></li><li><a href="#æ‰©å±•">æ‰©å±•</a><ul><li><a href="#commitrootimpl-ä¸‰æ¬¡æ‰§è¡Œ-flushpassiveeffects-æœ‰ä½•å«ä¹‰">commitRootImpl ä¸‰æ¬¡æ‰§è¡Œ flushPassiveEffects æœ‰ä½•å«ä¹‰ï¼Ÿ</a></li></ul></li><li><a href="#é—®é¢˜">é—®é¢˜</a><ul><li><a href="#ä¸ºä»€ä¹ˆåœ¨-layout-é˜¶æ®µä¹‹åéœ€è¦-requestpaint">ä¸ºä»€ä¹ˆåœ¨ layout é˜¶æ®µä¹‹åéœ€è¦ requestPaint?</a></li></ul></li><li><a href="#æ€»ç»“">æ€»ç»“</a></li><li><a href="#å‚è€ƒ">å‚è€ƒ</a></li></ul></div><p></p> <h2 id="å‰è¨€"><a href="#å‰è¨€" class="header-anchor">#</a> å‰è¨€</h2> <p>åœ¨ä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯¹ React æ¸²æŸ“è¿‡ç¨‹ä¸­çš„ â€œæ•è·â€ ä¸ â€œå†’æ³¡â€ è¿‡ç¨‹çš„ç†è§£æœ‰äº†æ›´æ·±ä¸€å±‚çš„è®¤è¯†ï¼Œå¹¶ä¸”ä»æ•´ä½“è„‰ç»œä¸Šæ€»ç»“äº†  <code>Batch</code>  é˜¶æ®µå’Œ  <code>Render</code>  é˜¶æ®µçš„è¿‡ç¨‹ã€‚ä»æœ¬æ–‡å¼€å§‹ï¼Œæˆ‘ä»¬å°†å¼€å§‹æ¢è®¨  <code>Commit</code>  é˜¶æ®µçš„åŸç†ï¼Œé€æ­¥äº†è§£ FiberTree å‘ DOMTree é£è·ƒçš„è¿‡ç¨‹ã€‚</p> <p>æ¸²æŸ“æ ¹æ®è°ƒåº¦æ–¹å¼çš„ä¸åŒè¢«åˆ†æˆäº†åŒæ­¥æ¸²æŸ“å’Œå¼‚æ­¥æ¸²æŸ“ï¼Œåœ¨åŒæ­¥çš„æ¸²æŸ“ç»“æŸåè°ƒç”¨  <code>commitRoot</code>  æäº¤æœ¬æ¬¡çš„è°ƒå’Œç»“æœï¼Œè€Œåœ¨å¼‚æ­¥æ¸²æŸ“ç»“æŸåæ˜¯é€šè¿‡  <code>finishConcurrentRender</code>  æ¥å¤„ç†åç»­çš„å·¥ä½œçš„ã€‚ä¸‹é¢æˆ‘ä»¬å°±ä»  <code>finishConcurrentRender</code>  å‡½æ•°å¼€å§‹æ·±å…¥åˆ†æã€‚</p> <h2 id="finishconcurrentrender"><a href="#finishconcurrentrender" class="header-anchor">#</a> finishConcurrentRender</h2> <p>ä»æœ¬è´¨ä¸Šæ¥è¯´  <code>finishConcurrentRender</code>  çš„æ ¸å¿ƒä½œç”¨è¿˜æ˜¯æ‰§è¡Œ  <code>commitRoot</code>  ä»¥æäº¤è°ƒå’Œç»“æœï¼Œä½†æ˜¯ç›¸æ¯”åŒæ­¥æ¸²æŸ“è€Œè¨€ï¼Œå¼‚æ­¥æ¸²æŸ“è¦æ›´åŠ å¤æ‚ï¼Œæ¢å¥è¯è¯´ï¼Œ <code>Render</code>  ç»“æŸåè¦è§†æƒ…å†µè€Œå®šæ˜¯å¦éœ€è¦ç«‹å³  <code>Commit</code> ï¼Œè¦æ ¹æ® <code>Render</code>  é˜¶æ®µçš„æ‰§è¡Œæƒ…å†µï¼ˆexitStatusï¼‰åŠ ä»¥ç¡®è®¤ã€‚ <code>Commit</code>  çš„æ“ä½œåº”å½“è¶³å¤Ÿé«˜æ•ˆï¼Œå› ä¸º DOM çš„ç»˜åˆ¶è¿‡ç¨‹æˆæœ¬ä¸è²ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">finishConcurrentRender</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> exitStatus<span class="token punctuation">,</span> lanes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>exitStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ......</span>
    <span class="token keyword">case</span> <span class="token literal-property property">RootErrored</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">commitRoot</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token literal-property property">RootSuspended</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token literal-property property">RootSuspendedWithDelay</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">markRootSuspended</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// ......</span>
      <span class="token comment">// The work expired. Commit immediately.</span>
      <span class="token function">commitRoot</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token literal-property property">RootCompleted</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// The work completed. Ready to commit.</span>
      <span class="token function">commitRoot</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//  ......</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>åˆ†æå¦‚ä¸‹ï¼š</p> <ul><li>åªæœ‰åœ¨å‘ç”Ÿæ™®é€šé”™è¯¯çš„æ—¶å€™æ‰å…è®¸æäº¤ï¼Œ <code>RootIncomplete</code>  (æœªå®ŒæˆçŠ¶æ€) å’Œ <code>RootFatalErrored</code> ï¼ˆè‡´å‘½é”™è¯¯çŠ¶æ€ï¼‰æ˜¯ä¸å…è®¸æäº¤çš„ã€‚è¿™ä¹Ÿå¾ˆç¬¦åˆé¢„æœŸï¼Œå› ä¸ºåœ¨è¿›å…¥æ­¤å‡½æ•°ä¹‹å‰ï¼Œæ™®é€šé”™è¯¯å°±å·²ç»é‡è¯•å¤šæ¬¡äº†ã€‚</li> <li>å¯¹äº  <code>RootSuspended</code>  å’Œ  <code>RootSuspendedWithDelay</code> ï¼Œå¿…é¡»ç­‰åˆ°ä»»åŠ¡è¶…æ—¶ï¼Œæ‰èƒ½å¤Ÿè¿›è¡Œæäº¤ã€‚</li></ul> <h2 id="commitroot"><a href="#commitroot" class="header-anchor">#</a> commitRoot</h2> <div class="badge-group" data-v-ac1337e0><span class="group-tag" data-v-ac1337e0>æ ‡ç­¾ï¼š</span> <span class="badge tip" style="vertical-align:top;" data-v-ac1337e0 data-v-4f7c9f45>é‡è¦</span></div> <p><code>commitRoot</code>  ä¸»è¦è°ƒç”¨  <code>commitRootImpl</code>  å‡½æ•°ï¼Œæºç å¦‚ä¸‹ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">commitRootImpl</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> renderPriorityLevel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token comment">// `flushPassiveEffects` will call `flushSyncUpdateQueue` at the end, which</span>
    <span class="token comment">// means `flushPassiveEffects` will sometimes result in additional</span>
    <span class="token comment">// passive effects. So we need to keep flushing in a loop until there are</span>
    <span class="token comment">// no more pending effects.</span>
    <span class="token function">flushPassiveEffects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>rootWithPendingPassiveEffects <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ......</span>
  <span class="token comment">// ç¡®ä¿å½“å‰æ˜¯ Batch çŠ¶æ€</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>executionContext <span class="token operator">&amp;</span> <span class="token punctuation">(</span>RenderContext <span class="token operator">|</span> CommitContext<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span> NoContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Should not already be working.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> finishedWork <span class="token operator">=</span> root<span class="token punctuation">.</span>finishedWork<span class="token punctuation">;</span>
  <span class="token comment">// å½“å‰ commit çš„ä¼˜å…ˆçº§</span>
  <span class="token keyword">const</span> lanes <span class="token operator">=</span> root<span class="token punctuation">.</span>finishedLanes<span class="token punctuation">;</span>
  <span class="token comment">// ......</span>
  <span class="token comment">// åˆå¹¶finishedWorkå­æ ‘çš„ lanesï¼Œå‰©ä½™çš„æœªå¤„ç†çš„ä¼˜å…ˆçº§</span>
  <span class="token keyword">let</span> remainingLanes <span class="token operator">=</span> <span class="token function">mergeLanes</span><span class="token punctuation">(</span>finishedWork<span class="token punctuation">.</span>lanes<span class="token punctuation">,</span> finishedWork<span class="token punctuation">.</span>childLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å°†å‰©ä½™æœªå¤„ç†çš„ä¼˜å…ˆçº§æŒ‚è½½åˆ° root.pendingLanes ä¸Š</span>
  <span class="token function">markRootFinished</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> remainingLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ......</span>
  <span class="token comment">// If there are pending passive effects, schedule a callback to process them.</span>
  <span class="token comment">// Do this as early as possible, so it is queued before anything else that</span>
  <span class="token comment">// might get scheduled in the commit phase. </span>
  <span class="token comment">// ç¡®ä¿å­æ ‘æœ‰ PassiveMask å‰¯ä½œç”¨æ—¶è¢«è°ƒåº¦ä»¥å¤„ç†å‰¯ä½œç”¨</span>
  <span class="token comment">// const PassiveMask = Passive | ChildDeletion;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token punctuation">(</span>finishedWork<span class="token punctuation">.</span>subtreeFlags <span class="token operator">&amp;</span> PassiveMask<span class="token punctuation">)</span> <span class="token operator">!==</span> NoFlags <span class="token operator">||</span>
    <span class="token punctuation">(</span>finishedWork<span class="token punctuation">.</span>flags <span class="token operator">&amp;</span> PassiveMask<span class="token punctuation">)</span> <span class="token operator">!==</span> NoFlags
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rootDoesHavePassiveEffects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      rootDoesHavePassiveEffects <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token comment">// ......</span>
      <span class="token function">scheduleCallback</span><span class="token punctuation">(</span>NormalSchedulerPriority<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">flushPassiveEffects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// This render triggered passive effects</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Check if there are any effects in the whole tree.</span>
  <span class="token comment">// åˆ¤æ–­å­æ ‘æ˜¯å¦æœ‰å‰¯ä½œç”¨</span>
  <span class="token keyword">const</span> subtreeHasEffects <span class="token operator">=</span>
    <span class="token punctuation">(</span>finishedWork<span class="token punctuation">.</span>subtreeFlags <span class="token operator">&amp;</span>
      <span class="token punctuation">(</span>BeforeMutationMask <span class="token operator">|</span> MutationMask <span class="token operator">|</span> LayoutMask <span class="token operator">|</span> PassiveMask<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span>
    NoFlags<span class="token punctuation">;</span>
  <span class="token comment">// åˆ¤æ–­æ ¹èŠ‚ç‚¹æ˜¯å¦æœ‰å‰¯ä½œç”¨</span>
  <span class="token keyword">const</span> rootHasEffect <span class="token operator">=</span>
    <span class="token punctuation">(</span>finishedWork<span class="token punctuation">.</span>flags <span class="token operator">&amp;</span>
      <span class="token punctuation">(</span>BeforeMutationMask <span class="token operator">|</span> MutationMask <span class="token operator">|</span> LayoutMask <span class="token operator">|</span> PassiveMask<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span>
    NoFlags<span class="token punctuation">;</span>
  <span class="token comment">// å¦‚æœå­æ ‘æˆ–è€…æ ¹èŠ‚ç‚¹æœ‰å‰¯ä½œç”¨ï¼Œåˆ™å¤„ç†ä¹‹</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>subtreeHasEffects <span class="token operator">||</span> rootHasEffect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ......</span>
    <span class="token keyword">const</span> prevExecutionContext <span class="token operator">=</span> executionContext<span class="token punctuation">;</span>
    <span class="token comment">// executionContext æ›´æ–°ä¸º CommitContext</span>
    executionContext <span class="token operator">|=</span> CommitContext<span class="token punctuation">;</span>
    <span class="token comment">// ......</span>
    <span class="token comment">// The commit phase is broken into several sub-phases. We do a separate pass</span>
    <span class="token comment">// of the effect list for each phase: all mutation effects come before all</span>
    <span class="token comment">// layout effects, and so on.</span>

    <span class="token comment">// The first phase a &quot;before mutation&quot; phase. We use this phase to read the</span>
    <span class="token comment">// state of the host tree right before we mutate it. This is where</span>
    <span class="token comment">// getSnapshotBeforeUpdate is called.</span>
    <span class="token comment">// Commit  é˜¶æ®µåˆ†æˆä¸‰ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«æ˜¯ before mutation, mutation å’Œ layoutã€‚</span>
    <span class="token comment">// before mutation é˜¶æ®µåœ¨ mutation ä¹‹å‰è¯»å–æ—§çŠ¶æ€ï¼Œå¹¶è°ƒç”¨ç›¸å…³çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°</span>
    <span class="token keyword">const</span> shouldFireAfterActiveInstanceBlur <span class="token operator">=</span> <span class="token function">commitBeforeMutationEffects</span><span class="token punctuation">(</span>
      root<span class="token punctuation">,</span>
      finishedWork<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ......</span>
    <span class="token comment">// The next phase is the mutation phase, where we mutate the host tree.</span>
    <span class="token comment">// mutation é˜¶æ®µå¯¹å‰¯ä½œç”¨è¿›è¡Œæ‰§è¡Œå’Œæ›´æ–°ï¼Œæ‰§è¡Œ DOM æ“ä½œï¼Œè°ƒç”¨ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°</span>
    <span class="token function">commitMutationEffects</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> finishedWork<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ......</span>
    <span class="token comment">// The work-in-progress tree is now the current tree. This must come after</span>
    <span class="token comment">// the mutation phase, so that the previous tree is still current during</span>
    <span class="token comment">// componentWillUnmount, but before the layout phase, so that the finished</span>
    <span class="token comment">// work is current during componentDidMount/Update.</span>
    <span class="token comment">// workInProgress æ ‘åˆ‡æ¢åˆ°currentæ ‘çš„æ—¶æœºæ˜¯åœ¨mutationç»“æŸåï¼Œlayoutå¼€å§‹å‰ã€‚</span>
    <span class="token comment">// è¿™æ ·åšçš„åŸå› æ˜¯åœ¨mutationé˜¶æ®µè°ƒç”¨ç±»ç»„ä»¶çš„componentWillUnmountçš„æ—¶å€™ï¼Œè¿˜å¯ä»¥è·å–åˆ°å¸è½½å‰çš„ç»„ä»¶ä¿¡æ¯ï¼›</span>
    <span class="token comment">// åœ¨layouté˜¶æ®µè°ƒç”¨componentDidMount/Updateæ—¶ï¼Œè·å–çš„ç»„ä»¶ä¿¡æ¯æ›´æ–°åçš„ã€‚</span>
    root<span class="token punctuation">.</span>current <span class="token operator">=</span> finishedWork<span class="token punctuation">;</span>
    <span class="token comment">// The next phase is the layout phase, where we call effects that read</span>
    <span class="token comment">// the host tree after it's been mutated. The idiomatic use case for this is</span>
    <span class="token comment">// layout, but class component lifecycles also fire here for legacy reasons.</span>
    <span class="token comment">// layout é˜¶æ®µåœ¨ mutation é˜¶æ®µä¹‹åï¼Œè¯»å–ç»„ä»¶çš„æœ€æ–°çŠ¶æ€ï¼Œå¹¶æ‰§è¡Œç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°</span>
    <span class="token function">commitLayoutEffects</span><span class="token punctuation">(</span>finishedWork<span class="token punctuation">,</span> root<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ......</span>
    <span class="token comment">// Tell Scheduler to yield at the end of the frame, so the browser has an</span>
    <span class="token comment">// opportunity to paint.</span>
    <span class="token comment">// è¯·æ±‚è°ƒåº¦å™¨åœ¨å¸§å°¾é˜»å¡ `Render` è¿‡ç¨‹ï¼Œä»¥ä½¿æµè§ˆå™¨æœ‰è¶³å¤Ÿçš„ç©ºé—²æ—¶é—´ç»˜åˆ¶è§†å›¾</span>
    <span class="token function">requestPaint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Commit å®Œæ¯•åæ¢å¤  executionContext </span>
    executionContext <span class="token operator">=</span> prevExecutionContext<span class="token punctuation">;</span>
    <span class="token comment">// ......</span>
  <span class="token punctuation">}</span> 
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token function">includesSomeLane</span><span class="token punctuation">(</span>pendingPassiveEffectsLanes<span class="token punctuation">,</span> SyncLane<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    root<span class="token punctuation">.</span>tag <span class="token operator">!==</span> LegacyRoot
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">flushPassiveEffects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ......</span>
  <span class="token comment">// é€€å‡º commitRoot æ—¶è°ƒç”¨ï¼Œç¡®ä¿ Root ä¸Šæ–°çš„ä»»åŠ¡ä¼šè¢«è°ƒåº¦</span>
  <span class="token function">ensureRootIsScheduled</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ......</span>
  <span class="token comment">// If layout work was scheduled, flush it now.</span>
  <span class="token function">flushSyncCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ......</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br></div></div><p>æ­¤å‡½æ•°æ¶µç›–äº†  <code>Commit</code>  é˜¶æ®µçš„æ•´ä¸ªè¿‡ç¨‹ï¼Œæœ‰ä¸€äº›ç»†èŠ‚é—®é¢˜åˆ†æå¦‚ä¸‹ï¼š</p> <ul><li><code>flushPassiveEffects</code> :  <code>flushPassiveEffects</code>  ä¸»è¦ä¸  <code>useEffect</code>  çš„å‰¯ä½œç”¨ç›¸å…³ï¼Œæ­¤å‡½æ•°ä»¥åŒæ­¥æˆ–è€…å¼‚æ­¥çš„æ–¹å¼æ‰§è¡Œ  <code>useEffect</code>  çš„é”€æ¯å‡½æ•°å’Œå›è°ƒå‡½æ•°ã€‚ç»†èŠ‚éƒ¨åˆ†å°†åœ¨ hook ç›¸å…³ç« èŠ‚è¿›è¡Œè¯¦ç»†æ¢è®¨ã€‚å¦‚æœå­æ ‘æœ‰  <code>PassiveMask</code>  æ ‡è®°ï¼Œåˆ™åœ¨è°ƒåº¦å™¨çš„å›è°ƒä¸­è°ƒç”¨  <code>flushPassiveEffects</code> ã€‚</li> <li>æœ‰å››ç§å‰¯ä½œç”¨æ ‡è®°è¢«ç”¨æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦  <code>Commit</code> ï¼Œåˆ†åˆ«æ˜¯ï¼š <code>BeforeMutationMask</code> ã€ <code>MutationMask</code> ã€ <code>LayoutMask</code> ã€ <code>PassiveMask</code> ã€‚å½“  <code>finishedWork</code>  æ ¹èŠ‚ç‚¹ä¸Šæˆ–è€…å­æ ‘ä¸Šå…·æœ‰å¦‚ä¸Šçš„å‰¯ä½œç”¨ï¼Œåˆ™æ‰§è¡Œ  <code>Commit</code>  æ“ä½œã€‚</li> <li><code>Commit</code>  è¿‡ç¨‹åˆ†æˆä¸‰ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«æ˜¯  <code>beforeMutation</code> ã€ <code>mutation</code>  å’Œ <code>layout</code> ï¼Œåˆ†åˆ«è°ƒç”¨  <code>commitBeforeMutationEffects</code> ã€ <code>commitMutationEffects</code>  å’Œ  <code>commitLayoutEffects</code> ã€‚</li> <li>workInProgress FiberTree æˆä¸º current FiberTree æ˜¯åœ¨  <code>mutation</code>  é˜¶æ®µä¹‹åã€layout é˜¶æ®µä¹‹å‰å®Œæˆçš„ï¼Œ <code>root.current = finishedWork</code> ã€‚ä¹‹å‰çš„ current FiberTree ç°åœ¨åˆ©ç´¢å½“å‰çš„å°±æˆäº†  <code>workInProgress FiberTree</code> ã€‚</li> <li>åœ¨  <code>mutation</code>  é˜¶æ®µï¼ŒReact å·²ç»æ ¹æ® EffectTag æ“çºµ JavaScript å¯¹ DOM è¿›è¡Œäº†æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼Œç”±äºæµè§ˆå™¨çš„ç©ºé—²æ—¶é—´å®é™…ä¸Šæ˜¯è¢«è°ƒåº¦å™¨æ§åˆ¶çš„ï¼Œæ‰€ä»¥åœ¨  <code>layout</code>  é˜¶æ®µå®Œæˆä¹‹åï¼Œéœ€è¦é€šçŸ¥è°ƒåº¦å™¨è¿›è¡Œ yieldï¼ˆé˜»å¡æ¸²æŸ“å›è°ƒï¼‰ï¼Œç»™æµè§ˆå™¨é‡ç»˜ç•™ä¸‹å……è¶³çš„æ—¶é—´ã€‚ <code>requestPaint</code>  å‡½æ•°å°†åœ¨è°ƒåº¦å™¨éƒ¨åˆ†è¿›è¡Œè¯¦ç»†çš„åˆ†æã€‚</li></ul> <div class="custom-block tip"><p class="custom-block-title">æ—§ç‰ˆæœ¬çš„æ‰§è¡Œé€»è¾‘</p> <p>ä¸‰ä¸ªé˜¶æ®µï¼š</p> <ul><li>before mutationï¼šè¯»å–ç»„ä»¶å˜æ›´å‰çš„çŠ¶æ€ï¼Œé’ˆå¯¹ç±»ç»„ä»¶ï¼Œè°ƒç”¨ getSnapshotBeforeUpdateï¼Œè®©æˆ‘ä»¬å¯ä»¥åœ¨ DOM å˜æ›´å‰è·å–ç»„ä»¶å®ä¾‹çš„ä¿¡æ¯ï¼›é’ˆå¯¹å‡½æ•°ç»„ä»¶ï¼Œå¼‚æ­¥è°ƒåº¦ useEffectã€‚</li> <li>mutationï¼šé’ˆå¯¹ HostComponentï¼Œè¿›è¡Œç›¸åº”çš„ DOM æ“ä½œï¼›é’ˆå¯¹ç±»ç»„ä»¶ï¼Œè°ƒç”¨ componentWillUnmountï¼›é’ˆå¯¹å‡½æ•°ç»„ä»¶ï¼Œæ‰§è¡Œ useLayoutEffect çš„é”€æ¯å‡½æ•°ã€‚</li> <li>layoutï¼šåœ¨ DOM æ“ä½œå®Œæˆåï¼Œè¯»å–ç»„ä»¶çš„çŠ¶æ€ï¼Œé’ˆå¯¹ç±»ç»„ä»¶ï¼Œè°ƒç”¨ç”Ÿå‘½å‘¨æœŸ componentDidMount å’Œ componentDidUpdateï¼Œè°ƒç”¨ setState çš„å›è°ƒï¼›é’ˆå¯¹å‡½æ•°ç»„ä»¶å¡«å…… useEffect çš„ effect æ‰§è¡Œæ•°ç»„ï¼Œå¹¶è°ƒåº¦ useEffectã€‚</li></ul></div> <p>åœ¨è¿›å…¥ä¸‹é¢ä¸‰ä¸ªæ ¸å¿ƒå‡½æ•°çš„åˆ†æä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ†æä¸€ä¸‹ FiberTree ä¸Š Effect çš„éå†è¿‡ç¨‹ã€‚ä»ä¸Šæ–‡ä¸­æˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œæ–°ç‰ˆçš„ React å»é™¤äº† EffectList çš„æ¦‚å¿µï¼Œå°† Effect å†’æ³¡æ”¶é›†åˆ°  <code>subtreeFlags</code>  æ ‡è®°ä¸Šã€‚å› æ­¤ï¼Œåœ¨å¯¹ EffectList çš„éå†æ—¶ï¼Œå°±ä¸èƒ½ç›´æ¥ä½¿ç”¨æ—§ç‰ˆä¸­é“¾è¡¨çš„éå†æ–¹å¼ã€‚</p> <h2 id="effectlist-çš„éå†"><a href="#effectlist-çš„éå†" class="header-anchor">#</a> EffectList çš„éå†</h2> <p>ä¸‹é¢ä»¥  <code>commitMutationEffects</code>  æ¢è®¨ FiberTree ä¸­  <code>EffectList</code>  çš„éå†è¿‡ç¨‹ã€‚è¿™é‡ŒåŒæ ·åˆ†ä¸º â€œæ•è·â€ å’Œ â€œå†’æ³¡â€ çš„è¿‡ç¨‹ï¼Œå°†éå†è¿‡ç¨‹ç©¿æ’æ‰§è¡Œçš„å·¥ä½œå¯ä»¥ç†è§£ä¸º  <code>beginWork</code>  å’Œ  <code>completeWork</code> ã€‚ï¼ˆæ³¨æ„ï¼Œæ­¤æ—¶éå†çš„åŸç†ä¸è°ƒå’Œ FiberTree æ—¶éå†çš„åŸç†ä¸€è‡´ï¼‰ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/react/packages/react-reconciler/src/ReactFiberCommitWork.new.js</span>
<span class="token keyword">function</span> <span class="token function">commitMutationEffects</span><span class="token punctuation">(</span> 
  <span class="token parameter"><span class="token literal-property property">root</span><span class="token operator">:</span> FiberRoot<span class="token punctuation">,</span>
  <span class="token literal-property property">firstChild</span><span class="token operator">:</span> Fiber<span class="token punctuation">,</span></span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  nextEffect <span class="token operator">=</span> firstChild<span class="token punctuation">;</span>
  <span class="token function">commitMutationEffects_begin</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">commitMutationEffects_begin</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">root</span><span class="token operator">:</span> FiberRoot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>nextEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fiber <span class="token operator">=</span> nextEffect<span class="token punctuation">;</span>
    <span class="token comment">// begin work......ï¼ˆbeginWorkæ’æ§½ï¼‰</span>
    <span class="token keyword">const</span> child <span class="token operator">=</span> fiber<span class="token punctuation">.</span>child<span class="token punctuation">;</span>
    <span class="token comment">// MutationMask æˆ–è€… BeforeMutationMask æˆ–è€… LayoutMask</span>
    <span class="token comment">// å¦‚æœå½“å‰ Fiber æœ‰ subtreeFlagsï¼Œè¯´æ˜å­æ ‘ä¸­æœ‰ç›¸åº”çš„ EffectTag</span>
    <span class="token comment">// è¿™é‡Œçš„åˆ¤æ–­å†³å®šæ˜¯å¦éœ€è¦ç»§ç»­æ•è·</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fiber<span class="token punctuation">.</span>subtreeFlags <span class="token operator">&amp;</span> MutationMask<span class="token punctuation">)</span> <span class="token operator">!==</span> NoFlags <span class="token operator">&amp;&amp;</span> child <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ......</span>
      <span class="token comment">// å°†å­èŠ‚ç‚¹ä½œä¸ºä¸‹ä¸€ä¸ªéå†çš„èŠ‚ç‚¹ï¼Œå‘ä¸‹æ•è·</span>
      nextEffect <span class="token operator">=</span> child<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// ä¸ç¬¦åˆä¸Šè¿°æ¡ä»¶ï¼Œè¯´æ˜å­æ ‘ä¸­æ— å“åº”çš„ EffectTagï¼Œå› æ­¤å¼€å§‹å†’æ³¡</span>
      <span class="token function">commitMutationEffects_complete</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">commitMutationEffects_complete</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">root</span><span class="token operator">:</span> FiberRoot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>nextEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fiber <span class="token operator">=</span> nextEffect<span class="token punctuation">;</span>

    <span class="token comment">// complete work......ï¼ˆcompleteWorkæ’æ§½ï¼‰</span>
    <span class="token comment">// å†’æ³¡æ—¶å…ˆå†’æ³¡åˆ°å…„å¼ŸèŠ‚ç‚¹ï¼Œæ— å…„å¼ŸèŠ‚ç‚¹æ—¶å†å†’æ³¡åˆ°çˆ¶èŠ‚ç‚¹</span>
    <span class="token comment">// å†’æ³¡ä¸€æ¬¡åéœ€è¦ä»…æ­¤è¿›è¡Œæ•è·çš„åˆ¤æ–­ï¼Œå› æ­¤éœ€è¦ return</span>
    <span class="token keyword">const</span> sibling <span class="token operator">=</span> fiber<span class="token punctuation">.</span>sibling<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sibling <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ......</span>
      nextEffect <span class="token operator">=</span> sibling<span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    nextEffect <span class="token operator">=</span> fiber<span class="token punctuation">.</span>return<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>å¼„æ¸…æ¥šä¸Šè¿°çš„ â€œæ•è·â€ å’Œ â€œå†’æ³¡â€ çš„éå†è¿‡ç¨‹ä¹‹åï¼Œåœ¨ä¸‹æ–‡ä¸­  <code>commitBeforeMutationEffects</code> ã€ <code>commitMutationEffects</code>  å’Œ <code>commitLayoutEffects</code>  ä¸‰ä¸ªå‡½æ•°ä¸­éƒ½æ˜¯å¯¹æ­¤éå†æ–¹æ³•çš„åº”ç”¨ã€‚å› æ­¤åœ¨ä¸‹æ–‡çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬å°†ç€é‡æ¢è®¨  <code>beginWork</code>  å’Œ  <code>completeWork</code>  æ’æ§½ä¸­çš„å·¥ä½œç»†èŠ‚ã€‚</p> <h2 id="commitbeforemutationeffects"><a href="#commitbeforemutationeffects" class="header-anchor">#</a> commitBeforeMutationEffects</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// completeWorkæ’æ§½</span>
<span class="token function">commitBeforeMutationEffectsOnFiber</span><span class="token punctuation">(</span>fiber<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>åˆ†æå¦‚ä¸‹ï¼š</p> <ul><li>åœ¨å†’æ³¡é˜¶æ®µåœ¨ fiber ä¸Šæ‰§è¡Œ  <code>commitBeforeMutationEffectsOnFiber</code> ã€‚</li></ul> <h2 id="commitmutationeffects"><a href="#commitmutationeffects" class="header-anchor">#</a> commitMutationEffects</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// beginWorkæ’æ§½</span>
<span class="token keyword">const</span> deletions <span class="token operator">=</span> fiber<span class="token punctuation">.</span>deletions<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>deletions <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> deletions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> childToDelete <span class="token operator">=</span> deletions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">commitDeletion</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> childToDelete<span class="token punctuation">,</span> fiber<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ......</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// completeWorkæ’æ§½</span>
<span class="token function">commitMutationEffectsOnFiber</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>åˆ†æå¦‚ä¸‹ï¼š</p> <ul><li>åœ¨æ•è·é˜¶æ®µæŸ¥æ‰¾ fiber ä¸Š  <code>deletions</code>  æ”¶é›†çš„å¾…åˆ é™¤çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”æäº¤èŠ‚ç‚¹çš„åˆ é™¤ã€‚</li> <li>åœ¨å†’æ³¡é˜¶æ®µè°ƒç”¨  <code>commitMutationEffectsOnFiber</code> ã€‚</li> <li>ä¸ºä»€ä¹ˆåˆ é™¤æ“ä½œè¦åœ¨æ•è·é˜¶æ®µå•ç‹¬è¿›è¡Œï¼Œè€Œä¸æ˜¯æ”¾åœ¨å†’æ³¡é˜¶æ®µä¸€èµ·å¤„ç†ï¼Ÿå› ä¸ºåˆ é™¤æ“ä½œç›¸å¯¹äºæ›´æ–°æ“ä½œï¼ˆæ·»åŠ æˆ–è€…æ›´æ–°ï¼‰è€Œè¨€è¦ç®€å•è®¸å¤šï¼Œåœ¨å½“å‰å·²ç»éå†åˆ°çš„èŠ‚ç‚¹ä¸Šï¼Œåªéœ€å°†å‰ç½®å·¥ä½œä¸­æ”¶é›†åˆ°çš„å¾…åˆ é™¤çš„èŠ‚ç‚¹è¿›è¡Œå¤„ç†å³å¯ï¼›ç›¸å¯¹è€Œè¨€ï¼Œ <code>commitMutationEffectsOnFiber</code>  çš„å¤„ç†è¿‡ç¨‹åˆ™è¦å¤æ‚çš„å¤šï¼Œéœ€è¦é€šè¿‡ä¸åŒçš„ EffectTag ä»¥è¿›è¡Œä¸åŒçš„å¤„ç†ï¼Œå¹¶ä¸”å¤„ç†æ–¹å¼ä¹Ÿä¸ç»„ä»¶çš„ç±»å‹æœ‰å¾ˆå¤§çš„å…³è”ã€‚æ‰€ä»¥æ­¤å¤„å°†åˆ é™¤æ“ä½œåœ¨æ•è·æ—¶å³æ‰§è¡Œï¼Œä¸€æ˜¯å› ä¸ºåˆ é™¤æ“çºµæœ¬èº«ä¸ EffectTag ç±»å‹ã€ç»„ä»¶ç±»å‹æ— å…³ï¼Œè€Œæ˜¯å› ä¸ºæå‰å¤„ç†èƒ½å¤Ÿé¿å… DOM æ“ä½œçš„æ··ä¹±æ€§ã€‚</li></ul> <h2 id="commitlayouteffects"><a href="#commitlayouteffects" class="header-anchor">#</a> commitLayoutEffects</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// completeWorkæ’æ§½</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fiber<span class="token punctuation">.</span>flags <span class="token operator">&amp;</span> LayoutMask<span class="token punctuation">)</span> <span class="token operator">!==</span> NoFlags<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> current <span class="token operator">=</span> fiber<span class="token punctuation">.</span>alternate<span class="token punctuation">;</span>
  <span class="token comment">// ......</span>
  <span class="token function">commitLayoutEffectOnFiber</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> current<span class="token punctuation">,</span> fiber<span class="token punctuation">,</span> committedLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åˆ†æå¦‚ä¸‹ï¼š</p> <ul><li>åœ¨æ•è·é˜¶æ®µæ‰§è¡Œ  <code>commitLayoutEffectOnFiber</code> ï¼Œä½†éœ€ä½¿ fiber ä¸Šå…·æœ‰  <code>LayoutMask</code>  æ ‡è®°ã€‚</li></ul> <p>æˆ‘ä»¬å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œåœ¨ä¸Šè¿°  <code>commitBeforeMutationEffectsOnFiber</code> ã€ <code>commitMutationEffectsOnFiber</code>  å‡½æ•°ä¸­ï¼Œéƒ½æ²¡æœ‰ EffectTag çš„æ ‡è®°è¦æ±‚ï¼Œè€Œ  <code>commitLayoutEffectOnFiber</code>  å´è¦æ±‚ fiber å…·æœ‰  <code>LayoutMask</code>  æ ‡è®°ã€‚äº‹å®ä¸Š  <code>MutationMask</code> ã€ <code>BeforeMutationMask</code>  æˆ–è€…  <code>LayoutMask</code>  éƒ½æ˜¯ EffectTag çš„é›†åˆï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Groups of flags that are used in the commit phase to skip over trees that</span>
<span class="token comment">// don't contain effects, by checking subtreeFlags.</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> BeforeMutationMask <span class="token operator">=</span> Update <span class="token operator">|</span> Snapshot <span class="token operator">|</span> ChildDeletion <span class="token operator">|</span> Visibility<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> MutationMask <span class="token operator">=</span> Placement <span class="token operator">|</span> Update <span class="token operator">|</span> ChildDeletion <span class="token operator">|</span> ContentReset <span class="token operator">|</span> Ref <span class="token operator">|</span> Hydrating <span class="token operator">|</span> Visibility<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> LayoutMask <span class="token operator">=</span> Update <span class="token operator">|</span> Callback <span class="token operator">|</span> Ref <span class="token operator">|</span> Visibility<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>é€šè¿‡åˆ¤æ–­ subtreeFlags ä¸Šæ˜¯å¦æœ‰è¿™ä¸ª EffectTag çš„ç»„åˆï¼Œå¯ä»¥ä½¿æ•è·å’Œå†’æ³¡çš„è¿‡ç¨‹èƒ½å¤Ÿè¿›è¡Œçš„é’ˆå¯¹éœ€è¦è¿›è¡Œæ“ä½œçš„èŠ‚ç‚¹è¿›è¡Œå¤„ç†ã€‚</p> <h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="header-anchor">#</a> æ‰©å±•</h2> <h3 id="commitrootimpl-ä¸‰æ¬¡æ‰§è¡Œ-flushpassiveeffects-æœ‰ä½•å«ä¹‰"><a href="#commitrootimpl-ä¸‰æ¬¡æ‰§è¡Œ-flushpassiveeffects-æœ‰ä½•å«ä¹‰" class="header-anchor">#</a> <code>commitRootImpl</code>  ä¸‰æ¬¡æ‰§è¡Œ  <code>flushPassiveEffects</code>  æœ‰ä½•å«ä¹‰ï¼Ÿ</h3> <p>é¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œ <code>flushPassiveEffects</code>  æ˜¯ä¸  <code>useEffect</code>  æ‰€äº§ç”Ÿçš„çš„å‰¯ä½œç”¨æ˜¯å¯†åˆ‡ç›¸å…³çš„ï¼Œåœ¨å‘ç”Ÿä¸€æ¬¡ â€œæ¸²æŸ“â€ çš„å‰åï¼Œéœ€è¦å¯¹è¿™ç§  <code>Passive</code>  çš„å‰¯ä½œç”¨è¿›è¡Œå¤„ç†ï¼ŒåŒ…æ‹¬æ‰§è¡Œå‰¯ä½œç”¨çš„é”€æ¯å‡½æ•°å’Œå‰¯ä½œç”¨å‡½æ•°ã€‚</p> <p>æ‰€è°“å‰¯ä½œç”¨ï¼Œæ˜¯åœ¨æŸäº›è§¦å‘æ¸²æŸ“çš„æ—¶æœºä¸Šæ‰§è¡Œ DOM æ“ä½œã€ç½‘ç»œè¯·æ±‚ã€æ—¥å¿—æ‰“å°ã€äº‹ä»¶è®¢é˜…ã€å®šæ—¶ä»»åŠ¡ç­‰è¡Œä¸ºã€‚å‰¯ä½œç”¨æ˜¯ä¸èƒ½ç›´æ¥åœ¨ç»„ä»¶ä¸»ä½“ï¼ˆå‡½æ•°å¼ç»„ä»¶ï¼‰ä¸­æ‰§è¡Œçš„ï¼Œå› ä¸º React æ— æ³•ä¿è¯å‰¯ä½œç”¨åœ¨æ‰§è¡Œæ—¶æ‰€å¤„çš„ç¯å¢ƒæ˜¯æ­£ç¡®çš„ã€‚äº‹å®ä¸Šï¼Œåœ¨å‡½æ•°ä¸»ä½“æ‰§è¡Œæ—¶ï¼ŒReact è¿˜å¤„äºè°ƒå’Œé˜¶æ®µï¼Œå¹¶æ²¡æœ‰  <code>Commit</code>  ä¸‹ä¸€æ¬¡çš„æ¸²æŸ“ï¼Œå†µä¸”ç›´æ¥åœ¨å‡½æ•°ä½“ä¸­æ‰§è¡Œçš„å‰¯ä½œç”¨ä¼šæå¤§çš„é˜»å¡è°ƒå’Œçš„æ•ˆç‡ï¼ˆå‚ç…§å‰æ–‡å†…å®¹ï¼‰ã€‚</p> <p>å› æ­¤ï¼Œåœ¨å‡½æ•°å¼ç»„ä»¶çš„ä¸»ä½“å‡½æ•°ä¸­åº”å½“éµå¾ª â€œ<strong>åªå®šä¹‰ç»„ä»¶çš„ç‰¹æ€§å’Œè¡Œä¸ºæ–¹å¼ï¼ˆåŒ…æ‹¬è§†å›¾çš„å®šä¹‰ã€äº‹ä»¶å›è°ƒçš„å®šä¹‰ã€å‰¯ä½œç”¨çš„å®šä¹‰ã€çŠ¶æ€å’Œè®¡ç®—å±æ€§çš„å®šä¹‰ï¼Œå› æ­¤å¯ä»¥æŠŠå‡½æ•°å¼ç»„ä»¶åˆ†æˆ  <code>Render</code> ã€ <code>Callback/Handler</code> ã€ <code>Effect</code>  å’Œ <code>Props/State</code>  å››ä¸ªéƒ¨åˆ†ï¼‰ï¼Œä¸è¿›è¡Œé«˜æˆæœ¬çš„è®¡ç®—</strong> â€œçš„åŸåˆ™ï¼Œâ€œJSXâ€ æœ¬è´¨ä¸Šæ˜¯ä¸€ç§<strong>åŠ¨æ€çš„æè¿°å’Œå®šä¹‰ç»„ä»¶çš„è¯­æ³•ç³–</strong>ã€‚<strong>ç»„ä»¶çš„çŠ¶æ€å’Œè¡Œä¸ºçš„å˜åŒ–åº”è¯¥ç”±å‰¯ä½œç”¨å’Œäº‹ä»¶æœºåˆ¶æ¥æ¨åŠ¨</strong>ã€‚ï¼ˆæ³¨æ„ï¼šå‰¯ä½œç”¨è™½ç„¶å¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿç±»ä¼¼äºç±»ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†æ˜¯å…¶ç†å¿µæ˜¯æä¸ºä¸åŒçš„ï¼Œç›¸æ¯”è€Œè¨€ï¼Œå‰¯ä½œç”¨æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„äº§ç‰©ï¼Œè¦æ›´ä¸ºçµæ´»å’Œé«˜æ•ˆï¼Œ<strong>æŒ‰ç…§ç”Ÿå‘½å‘¨æœŸçš„æƒ³æ³•å»ç¼–å†™å‡½æ•°å¼ç»„ä»¶æ˜¯é”™è¯¯çš„ï¼ŒReact ä¸­æä¾›çš„å‰¯ä½œç”¨é’©å­å¹¶ä¸èƒ½å‡†ç¡®çš„ç¿»è¯‘ / è½¬åŒ–ä¸ºç±»ç»„ä»¶å„ç§ç”Ÿå‘½å‘¨æœŸ</strong>ï¼å‚è§<a href="https://zh-hans.reactjs.org/docs/hooks-faq.html#are-hooks-slow-because-of-creating-functions-in-render" target="_blank" rel="noopener noreferrer"> Hook ä¼šå› ä¸ºåœ¨æ¸²æŸ“æ—¶åˆ›å»ºå‡½æ•°è€Œå˜æ…¢å—ï¼Ÿ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚ï¼‰</p> <p>å›å½’æ•´ä½“ï¼Œ <code>commitRootImpl</code>  å‡½æ•°ä¸­å…±æœ‰ä¸‰æ¬¡  <code>flushPassiveEffects</code>  çš„è°ƒç”¨ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// [1]</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span><span class="token function">flushPassiveEffects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>rootWithPendingPassiveEffects <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// [2]</span>
<span class="token function">scheduleCallback</span><span class="token punctuation">(</span>NormalSchedulerPriority<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">flushPassiveEffects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// [3]</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">includesSomeLane</span><span class="token punctuation">(</span>pendingPassiveEffectsLanes<span class="token punctuation">,</span> SyncLane<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">flushPassiveEffects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>ç¬¬ä¸€æ¬¡æ‰§è¡Œ  <code>flushPassiveEffects</code>  æ˜¯åœ¨  <code>Commit</code>  ä¸‰å¤§æ­¥éª¤æœªå¼€å§‹ä¹‹å‰æ‰§è¡Œçš„ï¼Œç›®çš„æ˜¯åˆ¤æ–­æ˜¯å¦æœ‰æ®‹ç•™çš„  <code>passiveEffects</code> ï¼ˆuseEffect çš„å‰¯ä½œç”¨ï¼‰ æœªæ‰§è¡Œï¼Œå¦‚æœæœ‰åˆ™è°ƒç”¨  <code>flushPassiveEffects</code>  å¤„ç†ä¹‹ã€‚ä¹‹æ‰€æœ‰ç”¨  <code>while</code>  å¾ªç¯æ˜¯å› ä¸ºå‰¯ä½œç”¨æœ‰å¯èƒ½äº§ç”Ÿæ–°çš„å‰¯ä½œç”¨ï¼ˆæ³¨æ„ï¼šåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­ï¼Œåº”è¯¥é¿å…å‰¯ä½œç”¨ä¹‹é—´ç›¸äº’è°ƒç”¨ä»¥å…é€ æˆæ­»å¾ªç¯ï¼‰ã€‚</li> <li>ç¬¬äºŒæ¬¡æ‰§è¡Œ  <code>flushPassiveEffects</code>  æ˜¯åœ¨  <code>Commit</code>  ä¸‰å¤§æ­¥éª¤æœªå¼€å§‹ä¹‹å‰è¯·æ±‚ä¸€æ¬¡  <code>flushPassiveEffects</code>  çš„è°ƒåº¦ï¼Œä»å‰æ–‡ä¸­æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œ <code>Commit</code>  æ­¥éª¤ä¸­ä¼šé˜»å¡  <code>Render</code>  è¿‡ç¨‹ï¼Œä½†æ˜¯å¹¶ä¸ä¼šé˜»å¡è°ƒåº¦è¿‡ç¨‹ï¼Œå› æ­¤ï¼Œæ­¤æ¬¡  <code>flushPassiveEffects</code>  è°ƒåº¦èƒ½å¤Ÿä¿è¯å…¶æ‰§è¡Œæ—¶é—´èƒ½å¤Ÿåœ¨æœ¬æ¬¡  <code>Commit</code>  é˜¶æ®µä¹‹åï¼Œä¹Ÿå°±æ˜¯è¯´ <code>ä¼ ç»™ useEffect çš„å‡½æ•°ä¼šåœ¨æµè§ˆå™¨å®Œæˆå¸ƒå±€ä¸ç»˜åˆ¶ä¹‹åï¼Œåœ¨ä¸€ä¸ªå»¶è¿Ÿäº‹ä»¶ä¸­è¢«è°ƒç”¨</code> ï¼Œå‚è§<a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#timing-of-effects" target="_blank" rel="noopener noreferrer"> effect çš„æ‰§è¡Œæ—¶æœº<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</li> <li>ç¬¬ä¸‰æ¬¡æ‰§è¡Œ  <code>flushPassiveEffects</code>  æ˜¯åœ¨  <code>root.finishedLanes</code>  ä¸­æœ‰åŒæ­¥çš„ lanes çš„æ—¶æœºä¸‹ï¼Œè¿™è¯´æ˜æœ¬æ¬¡å‰¯ä½œç”¨çš„å¤„ç†çš„ä¼˜å…ˆçº§è¾ƒé«˜ï¼Œéœ€åŒæ­¥æ‰§è¡Œã€‚ <code>ä» React 18 å¼€å§‹ï¼Œå½“å®ƒæ˜¯ç¦»æ•£çš„ç”¨æˆ·è¾“å…¥ï¼ˆå¦‚ç‚¹å‡»ï¼‰çš„ç»“æœæ—¶ï¼Œæˆ–è€…å½“å®ƒæ˜¯ç”± flushSync åŒ…è£…çš„æ›´æ–°ç»“æœæ—¶ï¼Œä¼ é€’ç»™ useEffect çš„å‡½æ•°å°†åœ¨å±å¹•å¸ƒå±€å’Œç»˜åˆ¶ä¹‹å‰åŒæ­¥æ‰§è¡Œ</code> ï¼Œå‚è§<a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#timing-of-effects" target="_blank" rel="noopener noreferrer"> effect çš„æ‰§è¡Œæ—¶æœº<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</li></ul> <div class="custom-block tip"><p class="custom-block-title">é‡ç‚¹æç¤º</p> <ul><li><code>flushPassiveEffects</code>  çš„æ‰§è¡Œæ˜¯å¼‚æ­¥çš„ï¼Œæ˜¯é€šè¿‡è°ƒåº¦å™¨çš„è°ƒåº¦å®Œæˆçš„ï¼Œä½†æ˜¯å¯ä»¥ä¿è¯ç›¸å…³çš„å‰¯ä½œç”¨æ˜¯åœ¨å½“å‰  <code>Commit</code>  ä¹‹åï¼Œä¹Ÿå³è§†å›¾æ›´æ–°æ¸²æŸ“ä¹‹åæ‰§è¡Œã€‚</li> <li><code>useEffect</code>  ä¸­çš„å‰¯ä½œç”¨çš„æ‰§è¡Œæ—¶æœºæ˜¯ï¼š <code>Commit</code>  å®Œæˆä¹‹åè¿›å…¥  <code>Batch</code>  é˜¶æ®µä¸­çš„æŸä¸€æ¬¡è°ƒåº¦å™¨çš„å›è°ƒä¸­ï¼Œè¿›ä¸€æ­¥å°†å°±æ˜¯ï¼Œå±å¹•è§†å›¾å¸ƒå±€å’Œç»˜åˆ¶ä¹‹åçš„ä¸€ä¸ªå»¶è¿Ÿäº‹ä»¶ä¸­ã€‚ <code>useEffect</code>  ä¸­å‰¯ä½œç”¨çš„æ‰§è¡Œæ˜¯å¼‚æ­¥çš„ã€‚</li> <li><code>useEffect</code>  ä¸­çš„å‰¯ä½œç”¨ä¹Ÿå¯ä»¥åŒæ­¥çš„æ‰§è¡Œï¼ˆ <code>useLayoutEffect</code>  ä¸­å‰¯ä½œç”¨æ‰§è¡Œä¹‹åï¼Œåœ¨  <code>Commit</code>  å®Œæˆä¹‹æ—¶ï¼‰ï¼Œå½“ç„¶è¿™éœ€è¦ç‰¹æ®Šçš„æ¡ä»¶ã€‚</li></ul></div> <h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="header-anchor">#</a> é—®é¢˜</h2> <h3 id="ä¸ºä»€ä¹ˆåœ¨-layout-é˜¶æ®µä¹‹åéœ€è¦-requestpaint"><a href="#ä¸ºä»€ä¹ˆåœ¨-layout-é˜¶æ®µä¹‹åéœ€è¦-requestpaint" class="header-anchor">#</a> ä¸ºä»€ä¹ˆåœ¨  <code>layout</code>  é˜¶æ®µä¹‹åéœ€è¦  <code>requestPaint</code> ?</h3> <div class="custom-block tip"><p class="custom-block-title">æç¤º</p> <p>By default, the browser will wait until the current thread of execution finishes and do one consolidated reflow and repaint (as this is considered more efficient than doing many reflows and repaints). This is not specified in any specification so the browser can implement as it wants to.</p> <p>But, there are some specific operations that will generally trigger a reflow (and sometimes a corresponding repaint). These operations are operations (requesting certain properties related to the position of elements) which can only be completed when an accurate reflow has been done. So, it is possible to manually trigger a reflow by requesting one of these properties.</p> <p>å‚è§ï¼š<a href="https://stackoverflow.com/questions/27196753/when-does-the-dom-repaint-during-javascript-routines" target="_blank" rel="noopener noreferrer">html - When does the DOM repaint during Javascript routines? - Stack Overflow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¼šåœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œæ‰§è¡Œä¸€æ¬¡åˆå¹¶çš„  <code>reflow</code>  å’Œ  <code>repaint</code> ã€‚ä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µä¼šè§¦å‘  <code>reflow</code> ï¼Œè¿™å°±æ˜¯æ‰§è¡Œé‚£äº›åªæœ‰åœ¨  <code>reflow</code>  ä¹‹åæ‰èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚å› æ­¤ï¼Œæ“çºµ JavaScript æ‰§è¡Œ DOM æ“ä½œå¹¶ä¸æ˜¯ä¼šç«‹å³ä¿ƒä½¿æµè§ˆå™¨è¿›è¡Œ  <code>repaint</code> ï¼Œè¿™å…¶ä¸­æµè§ˆå™¨æœ‰è¯¸å¤šä¼˜åŒ–æªæ–½ä»¥ä¿è¯  <code>reflow</code>  å’Œ  <code>repaint</code>  é«˜æ•ˆçš„è¿›è¡Œã€‚</p> <h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <p>æœ¬æ–‡ä¸­æœ€æœ€è¦çš„å†…å®¹æ˜¯å¯¹  <code>commitRoot</code>  å‡½æ•°çš„åˆ†æã€‚ <code>commitRoot</code>  æ˜¯  <code>Commit</code>  é˜¶æ®µæçº²æŒˆé¢†çš„å‡½æ•°ï¼Œå®ƒå°†æ•´ä¸ª  <code>Commit</code>  çš„è¿‡ç¨‹åˆ†æˆäº†æœ€è¦çš„ä¸‰ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«æ˜¯  <code>beforeMutation</code> ã€ <code>mutation</code>  å’Œ  <code>layout</code> ã€‚è¿™ä¸‰ä¸ªæ­¥éª¤åˆ†åˆ«è°ƒç”¨  <code>commitBeforeMutationEffects</code> ã€ <code>commitMutationEffects</code>  å’Œ  <code>commitLayoutEffects</code>  å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œæ€»ç»“å…¶ç‰¹æ€§åˆ†åˆ«æ˜¯  <code>commitBeforeMutationEffects</code>  æä¾›ç»„ä»¶æ›´æ–°ä¹‹å‰çš„å®ä¾‹æ•°æ®ï¼Œ <code>commitMutationEffects</code>  æ“ä½œåŸç”Ÿ JavaScript æ›´æ–° DOM èŠ‚ç‚¹ï¼Œå¤„ç†ç»„ä»¶é”€æ¯å‰çš„å‰¯ä½œç”¨ï¼Œ <code>commitLayoutEffects</code>  å¤„ç†ç»„ä»¶æŒ‚è½½åï¼ˆæ›´æ–°åï¼‰çš„å‰¯ä½œç”¨ã€‚</p> <p>å¦å¤–ä¸€ä¸ªé‡ç‚¹æ˜¯ï¼Œ <code>workInProgress</code>  æ ‘åˆ‡æ¢ä¸º  <code>current</code>  æ ‘çš„è¿‡ç¨‹æ˜¯åœ¨  <code>mutation</code>  ä¹‹å  <code>layout</code>  ä¹‹å‰å®Œæˆçš„ã€‚ä¸‰ä¸ªæ­¥éª¤å®Œæˆä¹‹åéœ€è¦é€šçŸ¥è°ƒåº¦å™¨è¿›è¡Œ yield ï¼ˆä¸­æ–­  <code>Render</code>  é˜¶æ®µçš„æ‰§è¡Œï¼‰ï¼Œä»è€Œä½¿æµè§ˆå™¨æœ‰è¶³å¤Ÿçš„æ—¶é—´å¯¹  <code>mutation</code>  é˜¶æ®µé€ æˆçš„ DOM æ›´æ–°è¿›è¡Œé‡æ’ï¼ˆreflowï¼‰å’Œé‡ç»˜ï¼ˆrepaintï¼‰ã€‚</p> <p>ä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤è¿½æ ¹ç©¶åº•è¿˜æ˜¯åœ¨  <code>EffectList</code> ï¼ˆæ²¿ç”¨æ—§ç‰ˆæœ¬çš„æ¦‚å¿µï¼‰ çš„éå†è¿‡ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå…¶æ€»ä½“è¿‡ç¨‹å¯å½’çº³ä¸º â€œè·³è·ƒå¼çš„â€ï¼ˆå¯ç²¾å‡†çš„é’ˆå¯¹æœ‰ç›¸å…³  <code>EffectTagMask</code>  çš„èŠ‚ç‚¹è¿›è¡Œæ“ä½œï¼‰â€œæ•è·ä¸å†’æ³¡â€ çš„è¿‡ç¨‹ï¼Œå…¶å†…éƒ¨é€»è¾‘åŒæ ·å¯æŠ½è±¡ä¸º   <code>beginWork</code>  å’Œ  <code>completeWork</code>  çš„å·¥ä½œã€‚ä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤å…¶å®è´¨æ˜¯è¦æ‰§è¡Œ  <code>commitBeforeMutationEffectsOnFiber</code> ã€ <code>commitMutationEffectsOnFiber</code>  å’Œ  <code>commitLayoutEffectOnFiber</code>  å‡½æ•°ã€‚</p> <h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="header-anchor">#</a> å‚è€ƒ</h2> <ul><li>æ—§ç‰ˆæœ¬ï¼š<a href="https://ithelp.ithome.com.tw/articles/10255458" target="_blank" rel="noopener noreferrer">React æºç¢¼ commit éšæ®µè©³è§£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/jonsam-ng/fancy-front-end/edit/master/docs/10.react/90.Reactæºç æ¼‚æµè®°/150.react-reconciliation-7.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2022/08/08, 19:51:35</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/react/tour/react-reconciliation-6/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆå…­ï¼‰</div></a> <a href="/react/tour/react-reconciliation-8/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆå…«ï¼‰</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/react/tour/react-reconciliation-6/" class="prev">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆå…­ï¼‰</a></span> <span class="next"><a href="/react/tour/react-reconciliation-8/">React æºç æ¼‚æµè®°ï¼šReact è°ƒå’Œå™¨æ ¸å¿ƒæºç è§£è¯»ï¼ˆå…«ï¼‰</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/solid/render/render-by-jsx/"><div>
            æ¸²æŸ“åŸç†ä¹‹ç»„ä»¶ç»“æ„ä¸ JSX ç¼–è¯‘
            <!----></div></a> <span class="date">09-07</span></dt></dl><dl><dd>02</dd> <dt><a href="/solid/plan/"><div>
            è®¡åˆ’è·Ÿè¸ª
            <!----></div></a> <span class="date">09-06</span></dt></dl><dl><dd>03</dd> <dt><a href="/solid/index/"><div>
            å¼€å§‹ä¸Šæ‰‹
            <!----></div></a> <span class="date">09-06</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:jonsam.ng@foxmail.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/jonsam-ng" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://www.jonsam.site" title="åšå®¢" target="_blank" class="iconfont icon-mao"></a><a href="https://docs.jonsam.site" title="æ–‡æ¡£" target="_blank" class="iconfont icon-shuben"></a><a href="https://ml.jonsam.site" title="æœºå™¨å­¦ä¹ " target="_blank" class="iconfont icon-code"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2022-2022
    <span>Fancy Front End | Made by <a href="https://www.jonsam.site" target="_blank">Jonsam</a> by â¤</span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----><div></div><!----><div></div><div></div></div></div>
    <script src="/assets/js/app.eb21b6ee.js" defer></script><script src="/assets/js/2.01e091c2.js" defer></script><script src="/assets/js/54.5d7f6427.js" defer></script><script src="/assets/js/4.54e60667.js" defer></script><script src="/assets/js/12.71337abb.js" defer></script><script src="/assets/js/10.ac472f43.js" defer></script><script src="/assets/js/11.c50183f9.js" defer></script><script src="/assets/js/8.7cbef5ec.js" defer></script><script src="/assets/js/5.f620477b.js" defer></script>
  </body>
</html>

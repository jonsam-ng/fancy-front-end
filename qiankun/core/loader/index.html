<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>loadApp åŠ è½½å¾®åº”ç”¨ | Fancy Front End</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/assets/img/favicon.ico">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3314748_9xij1pv3h4i.css">
    <meta name="description" content="å‰ç«¯æºç é˜…è¯»æ ˆï¼Œç²¾è¯» Reactã€Vue3 æºç ">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="keywords" content="å‰ç«¯æºç ,Reactæºç ,Vueæºç ,Vu3æºç ,Webpackæºç ">
    <meta name="theme-color" content="#3CB982">
    
    <link rel="preload" href="/assets/css/0.styles.e2349a00.css" as="style"><link rel="preload" href="/assets/js/app.eb21b6ee.js" as="script"><link rel="preload" href="/assets/js/2.01e091c2.js" as="script"><link rel="preload" href="/assets/js/122.1452986d.js" as="script"><link rel="preload" href="/assets/js/4.54e60667.js" as="script"><link rel="preload" href="/assets/js/12.71337abb.js" as="script"><link rel="preload" href="/assets/js/10.ac472f43.js" as="script"><link rel="preload" href="/assets/js/11.c50183f9.js" as="script"><link rel="preload" href="/assets/js/8.7cbef5ec.js" as="script"><link rel="preload" href="/assets/js/5.f620477b.js" as="script"><link rel="prefetch" href="/assets/js/100.8081075e.js"><link rel="prefetch" href="/assets/js/101.943ea683.js"><link rel="prefetch" href="/assets/js/102.11c8554c.js"><link rel="prefetch" href="/assets/js/103.c2780521.js"><link rel="prefetch" href="/assets/js/104.81994794.js"><link rel="prefetch" href="/assets/js/105.f987244b.js"><link rel="prefetch" href="/assets/js/106.235a578e.js"><link rel="prefetch" href="/assets/js/107.94cdbb18.js"><link rel="prefetch" href="/assets/js/108.3a80cb29.js"><link rel="prefetch" href="/assets/js/109.8884be03.js"><link rel="prefetch" href="/assets/js/110.89ab5eb2.js"><link rel="prefetch" href="/assets/js/111.355b1782.js"><link rel="prefetch" href="/assets/js/112.34671c87.js"><link rel="prefetch" href="/assets/js/113.0cca0902.js"><link rel="prefetch" href="/assets/js/114.01616168.js"><link rel="prefetch" href="/assets/js/115.4915c0b5.js"><link rel="prefetch" href="/assets/js/116.ef93855a.js"><link rel="prefetch" href="/assets/js/117.e3526ed0.js"><link rel="prefetch" href="/assets/js/118.7d52a4ea.js"><link rel="prefetch" href="/assets/js/119.a4bb17bb.js"><link rel="prefetch" href="/assets/js/120.135aa6ea.js"><link rel="prefetch" href="/assets/js/121.86c35c15.js"><link rel="prefetch" href="/assets/js/123.0181b553.js"><link rel="prefetch" href="/assets/js/124.edc508f8.js"><link rel="prefetch" href="/assets/js/125.46d932c1.js"><link rel="prefetch" href="/assets/js/126.17e05a12.js"><link rel="prefetch" href="/assets/js/127.98159dfe.js"><link rel="prefetch" href="/assets/js/128.9aaa5bc6.js"><link rel="prefetch" href="/assets/js/129.26bed928.js"><link rel="prefetch" href="/assets/js/13.292db5f6.js"><link rel="prefetch" href="/assets/js/130.9f74c846.js"><link rel="prefetch" href="/assets/js/131.d6ef0885.js"><link rel="prefetch" href="/assets/js/132.1d9ee075.js"><link rel="prefetch" href="/assets/js/133.2b23ed7b.js"><link rel="prefetch" href="/assets/js/134.c47e8a23.js"><link rel="prefetch" href="/assets/js/135.2aeb3426.js"><link rel="prefetch" href="/assets/js/136.0169c47b.js"><link rel="prefetch" href="/assets/js/137.70cdfc24.js"><link rel="prefetch" href="/assets/js/138.e54160ee.js"><link rel="prefetch" href="/assets/js/139.9a6d1932.js"><link rel="prefetch" href="/assets/js/14.54d2636a.js"><link rel="prefetch" href="/assets/js/140.ddabaeca.js"><link rel="prefetch" href="/assets/js/141.35844ecc.js"><link rel="prefetch" href="/assets/js/142.4ccdb5e4.js"><link rel="prefetch" href="/assets/js/143.37a7f36e.js"><link rel="prefetch" href="/assets/js/144.95ff6a63.js"><link rel="prefetch" href="/assets/js/145.9899e545.js"><link rel="prefetch" href="/assets/js/146.6865658b.js"><link rel="prefetch" href="/assets/js/147.2a55d18a.js"><link rel="prefetch" href="/assets/js/148.f3aab640.js"><link rel="prefetch" href="/assets/js/149.57b565a0.js"><link rel="prefetch" href="/assets/js/15.81d908ff.js"><link rel="prefetch" href="/assets/js/150.3f7143ae.js"><link rel="prefetch" href="/assets/js/151.5981cf9e.js"><link rel="prefetch" href="/assets/js/152.a3428a7b.js"><link rel="prefetch" href="/assets/js/153.0f0b339d.js"><link rel="prefetch" href="/assets/js/154.39f3b522.js"><link rel="prefetch" href="/assets/js/155.13c8170a.js"><link rel="prefetch" href="/assets/js/156.ccb66614.js"><link rel="prefetch" href="/assets/js/157.4b8bce50.js"><link rel="prefetch" href="/assets/js/158.6476dd1c.js"><link rel="prefetch" href="/assets/js/159.b261a009.js"><link rel="prefetch" href="/assets/js/16.68d8e787.js"><link rel="prefetch" href="/assets/js/160.e501007d.js"><link rel="prefetch" href="/assets/js/161.d3f56d3d.js"><link rel="prefetch" href="/assets/js/162.f8590797.js"><link rel="prefetch" href="/assets/js/163.91fe4509.js"><link rel="prefetch" href="/assets/js/164.6e92f3f4.js"><link rel="prefetch" href="/assets/js/165.56868a39.js"><link rel="prefetch" href="/assets/js/166.83812a3b.js"><link rel="prefetch" href="/assets/js/167.4b528df4.js"><link rel="prefetch" href="/assets/js/168.f2b151fb.js"><link rel="prefetch" href="/assets/js/169.cb2ee128.js"><link rel="prefetch" href="/assets/js/17.895175dc.js"><link rel="prefetch" href="/assets/js/170.63b574e9.js"><link rel="prefetch" href="/assets/js/171.ad38a311.js"><link rel="prefetch" href="/assets/js/172.b592b97e.js"><link rel="prefetch" href="/assets/js/173.302ef08b.js"><link rel="prefetch" href="/assets/js/174.d71ad1a3.js"><link rel="prefetch" href="/assets/js/175.2617c860.js"><link rel="prefetch" href="/assets/js/176.19a67035.js"><link rel="prefetch" href="/assets/js/177.75aab37d.js"><link rel="prefetch" href="/assets/js/178.b2773712.js"><link rel="prefetch" href="/assets/js/179.6a34b45f.js"><link rel="prefetch" href="/assets/js/18.736b781d.js"><link rel="prefetch" href="/assets/js/180.d447fc48.js"><link rel="prefetch" href="/assets/js/181.d6b96886.js"><link rel="prefetch" href="/assets/js/182.42c2bcd5.js"><link rel="prefetch" href="/assets/js/183.a6256a82.js"><link rel="prefetch" href="/assets/js/184.8a036f5a.js"><link rel="prefetch" href="/assets/js/185.811d5831.js"><link rel="prefetch" href="/assets/js/186.6436a583.js"><link rel="prefetch" href="/assets/js/187.4bcf94a3.js"><link rel="prefetch" href="/assets/js/188.33f39bd6.js"><link rel="prefetch" href="/assets/js/189.c1b90840.js"><link rel="prefetch" href="/assets/js/19.504bd141.js"><link rel="prefetch" href="/assets/js/20.e526fb51.js"><link rel="prefetch" href="/assets/js/21.8375d39e.js"><link rel="prefetch" href="/assets/js/22.0e15b626.js"><link rel="prefetch" href="/assets/js/23.83bcc15c.js"><link rel="prefetch" href="/assets/js/24.3df554ce.js"><link rel="prefetch" href="/assets/js/25.6c56da2b.js"><link rel="prefetch" href="/assets/js/26.76154857.js"><link rel="prefetch" href="/assets/js/27.155dbcb4.js"><link rel="prefetch" href="/assets/js/28.7178e96c.js"><link rel="prefetch" href="/assets/js/29.f7337396.js"><link rel="prefetch" href="/assets/js/3.50570587.js"><link rel="prefetch" href="/assets/js/30.191545d3.js"><link rel="prefetch" href="/assets/js/31.b6a0fe90.js"><link rel="prefetch" href="/assets/js/32.18cebeab.js"><link rel="prefetch" href="/assets/js/33.146782c3.js"><link rel="prefetch" href="/assets/js/34.c08af9cb.js"><link rel="prefetch" href="/assets/js/35.ea730de0.js"><link rel="prefetch" href="/assets/js/36.11aba0b0.js"><link rel="prefetch" href="/assets/js/37.0fd8e20a.js"><link rel="prefetch" href="/assets/js/38.2cde6902.js"><link rel="prefetch" href="/assets/js/39.07c230cc.js"><link rel="prefetch" href="/assets/js/40.e4fcccd0.js"><link rel="prefetch" href="/assets/js/41.5f96c201.js"><link rel="prefetch" href="/assets/js/42.e5023440.js"><link rel="prefetch" href="/assets/js/43.2cfdc8d9.js"><link rel="prefetch" href="/assets/js/44.37f32c52.js"><link rel="prefetch" href="/assets/js/45.3973ea4b.js"><link rel="prefetch" href="/assets/js/46.87541312.js"><link rel="prefetch" href="/assets/js/47.04f0011f.js"><link rel="prefetch" href="/assets/js/48.1151f311.js"><link rel="prefetch" href="/assets/js/49.6830fb0c.js"><link rel="prefetch" href="/assets/js/50.84b34574.js"><link rel="prefetch" href="/assets/js/51.840f38c4.js"><link rel="prefetch" href="/assets/js/52.3dbda6e7.js"><link rel="prefetch" href="/assets/js/53.7f0a8896.js"><link rel="prefetch" href="/assets/js/54.5d7f6427.js"><link rel="prefetch" href="/assets/js/55.86c7b544.js"><link rel="prefetch" href="/assets/js/56.49a27b9a.js"><link rel="prefetch" href="/assets/js/57.287f9e58.js"><link rel="prefetch" href="/assets/js/58.40a49fdb.js"><link rel="prefetch" href="/assets/js/59.91487422.js"><link rel="prefetch" href="/assets/js/6.8880bb8c.js"><link rel="prefetch" href="/assets/js/60.8dfd58ee.js"><link rel="prefetch" href="/assets/js/61.7b4874b9.js"><link rel="prefetch" href="/assets/js/62.d83f3691.js"><link rel="prefetch" href="/assets/js/63.1237a900.js"><link rel="prefetch" href="/assets/js/64.1f096a25.js"><link rel="prefetch" href="/assets/js/65.809d988d.js"><link rel="prefetch" href="/assets/js/66.43c1e5f9.js"><link rel="prefetch" href="/assets/js/67.24ab137d.js"><link rel="prefetch" href="/assets/js/68.7b0346b5.js"><link rel="prefetch" href="/assets/js/69.2008c989.js"><link rel="prefetch" href="/assets/js/7.0c293177.js"><link rel="prefetch" href="/assets/js/70.e8cf3232.js"><link rel="prefetch" href="/assets/js/71.d661943d.js"><link rel="prefetch" href="/assets/js/72.e67a47a3.js"><link rel="prefetch" href="/assets/js/73.87f1db52.js"><link rel="prefetch" href="/assets/js/74.ac67cd0d.js"><link rel="prefetch" href="/assets/js/75.e25ebf69.js"><link rel="prefetch" href="/assets/js/76.a7222468.js"><link rel="prefetch" href="/assets/js/77.ffb71305.js"><link rel="prefetch" href="/assets/js/78.72c00bee.js"><link rel="prefetch" href="/assets/js/79.66ec368e.js"><link rel="prefetch" href="/assets/js/80.8792d3d7.js"><link rel="prefetch" href="/assets/js/81.49d3731a.js"><link rel="prefetch" href="/assets/js/82.fbe09e61.js"><link rel="prefetch" href="/assets/js/83.220a02bb.js"><link rel="prefetch" href="/assets/js/84.4b722410.js"><link rel="prefetch" href="/assets/js/85.f83d2db9.js"><link rel="prefetch" href="/assets/js/86.17b19d53.js"><link rel="prefetch" href="/assets/js/87.37568307.js"><link rel="prefetch" href="/assets/js/88.d7cc6612.js"><link rel="prefetch" href="/assets/js/89.ffb378d0.js"><link rel="prefetch" href="/assets/js/9.2a7e5bdc.js"><link rel="prefetch" href="/assets/js/90.02c91127.js"><link rel="prefetch" href="/assets/js/91.c22d9224.js"><link rel="prefetch" href="/assets/js/92.c79d457a.js"><link rel="prefetch" href="/assets/js/93.33a03732.js"><link rel="prefetch" href="/assets/js/94.c73ddbbc.js"><link rel="prefetch" href="/assets/js/95.a5151497.js"><link rel="prefetch" href="/assets/js/96.b8f204d2.js"><link rel="prefetch" href="/assets/js/97.d7ddaa6f.js"><link rel="prefetch" href="/assets/js/98.49dbda5e.js"><link rel="prefetch" href="/assets/js/99.d14f43ad.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e2349a00.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="Fancy Front End" class="logo"> <span class="site-name can-hide">Fancy Front End</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Reactæºç " class="dropdown-title"><a href="/react/index/" class="link-title">Reactæºç </a> <span class="title" style="display:none;">Reactæºç </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/index/" class="nav-link">å¼€å§‹ä¸Šæ‰‹</a></li><li class="dropdown-item"><!----> <a href="/react/basic/index/" class="nav-link">åŸºç¡€</a></li><li class="dropdown-item"><!----> <a href="/react/scheduler/index/" class="nav-link">è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰</a></li><li class="dropdown-item"><!----> <a href="/react/updater/index/" class="nav-link">æ›´æ–°å™¨ï¼ˆUpdaterï¼‰</a></li><li class="dropdown-item"><!----> <a href="/react/render/index/" class="nav-link">æ¸²æŸ“å™¨ï¼ˆRenderï¼‰</a></li><li class="dropdown-item"><!----> <a href="/react/update/index/" class="nav-link">æ›´æ–°å‘¨æœŸ</a></li><li class="dropdown-item"><!----> <a href="/react/hooks/index/" class="nav-link">hooks åŸç†</a></li><li class="dropdown-item"><!----> <a href="/react/summary/index/" class="nav-link">æ€»ç»“</a></li><li class="dropdown-item"><!----> <a href="/react/tour/index/" class="nav-link">ğŸ“™ Reactæºç æ¼‚æµè®°</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue3æºç " class="dropdown-title"><a href="/vue3/index/" class="link-title">Vue3æºç </a> <span class="title" style="display:none;">Vue3æºç </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/index/" class="nav-link">å¼€å§‹ä¸Šæ‰‹</a></li><li class="dropdown-item"><!----> <a href="/vue3/basic/index/" class="nav-link">åŸºç¡€</a></li><li class="dropdown-item"><!----> <a href="/vue3/reactivity/index/" class="nav-link">reactivity</a></li><li class="dropdown-item"><!----> <a href="/vue3/runtime-core/index/" class="nav-link">runtime-core</a></li><li class="dropdown-item"><!----> <a href="/vue3/runtime-dom/index/" class="nav-link">runtime-dom</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è¿›é˜¶" class="dropdown-title"><a href="/web/" class="link-title">è¿›é˜¶</a> <span class="title" style="display:none;">è¿›é˜¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/" class="nav-link">Awesome Web</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">Awesome NodeJS</a></li></ul></div></div><div class="nav-item"><a href="/topic/" class="nav-link">è¯é¢˜</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ›´å¤š" class="dropdown-title"><a href="/nav/" class="link-title">æ›´å¤š</a> <span class="title" style="display:none;">æ›´å¤š</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nav/" class="nav-link">å¯¼èˆª</a></li><li class="dropdown-item"><!----> <a href="/qa/" class="nav-link">Q&amp;A</a></li><li class="dropdown-item"><!----> <a href="/slides/#/1" class="nav-link">å¹»ç¯ç‰‡</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">å…³äº</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://www.jonsam.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/jonsam-ng/fancy-front-end" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/oxygen-space/image.5a0lthv367k0.png"> <div class="blogger-info"><h3>Jonsam NG</h3> <span>è®©æœ‰æ„ä¹‰çš„äº‹å˜å¾—æœ‰æ„æ€ï¼Œè®©æœ‰æ„æ€çš„äº‹å˜å¾—æœ‰æ„ä¹‰</span></div></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Reactæºç " class="dropdown-title"><a href="/react/index/" class="link-title">Reactæºç </a> <span class="title" style="display:none;">Reactæºç </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/index/" class="nav-link">å¼€å§‹ä¸Šæ‰‹</a></li><li class="dropdown-item"><!----> <a href="/react/basic/index/" class="nav-link">åŸºç¡€</a></li><li class="dropdown-item"><!----> <a href="/react/scheduler/index/" class="nav-link">è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰</a></li><li class="dropdown-item"><!----> <a href="/react/updater/index/" class="nav-link">æ›´æ–°å™¨ï¼ˆUpdaterï¼‰</a></li><li class="dropdown-item"><!----> <a href="/react/render/index/" class="nav-link">æ¸²æŸ“å™¨ï¼ˆRenderï¼‰</a></li><li class="dropdown-item"><!----> <a href="/react/update/index/" class="nav-link">æ›´æ–°å‘¨æœŸ</a></li><li class="dropdown-item"><!----> <a href="/react/hooks/index/" class="nav-link">hooks åŸç†</a></li><li class="dropdown-item"><!----> <a href="/react/summary/index/" class="nav-link">æ€»ç»“</a></li><li class="dropdown-item"><!----> <a href="/react/tour/index/" class="nav-link">ğŸ“™ Reactæºç æ¼‚æµè®°</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue3æºç " class="dropdown-title"><a href="/vue3/index/" class="link-title">Vue3æºç </a> <span class="title" style="display:none;">Vue3æºç </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/index/" class="nav-link">å¼€å§‹ä¸Šæ‰‹</a></li><li class="dropdown-item"><!----> <a href="/vue3/basic/index/" class="nav-link">åŸºç¡€</a></li><li class="dropdown-item"><!----> <a href="/vue3/reactivity/index/" class="nav-link">reactivity</a></li><li class="dropdown-item"><!----> <a href="/vue3/runtime-core/index/" class="nav-link">runtime-core</a></li><li class="dropdown-item"><!----> <a href="/vue3/runtime-dom/index/" class="nav-link">runtime-dom</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è¿›é˜¶" class="dropdown-title"><a href="/web/" class="link-title">è¿›é˜¶</a> <span class="title" style="display:none;">è¿›é˜¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/" class="nav-link">Awesome Web</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">Awesome NodeJS</a></li></ul></div></div><div class="nav-item"><a href="/topic/" class="nav-link">è¯é¢˜</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ›´å¤š" class="dropdown-title"><a href="/nav/" class="link-title">æ›´å¤š</a> <span class="title" style="display:none;">æ›´å¤š</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nav/" class="nav-link">å¯¼èˆª</a></li><li class="dropdown-item"><!----> <a href="/qa/" class="nav-link">Q&amp;A</a></li><li class="dropdown-item"><!----> <a href="/slides/#/1" class="nav-link">å¹»ç¯ç‰‡</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">å…³äº</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://www.jonsam.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/jonsam-ng/fancy-front-end" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/web/index/" class="sidebar-link">å¼€å§‹ä¸Šæ‰‹</a></li><li><a href="/web/plan/" class="sidebar-link">Plan è®¡åˆ’</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>typescript-utility</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>single-spaæºç </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>qiankunæºç </span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/qiankun/index/" class="sidebar-link">å¼€å§‹é˜…è¯»</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>core</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/qiankun/core/index/" class="sidebar-link">æœ¬ç« æ¦‚è¦</a></li><li><a href="/qiankun/core/apis/" class="sidebar-link">æ ¸å¿ƒ API</a></li><li><a href="/qiankun/core/loader/" aria-current="page" class="active sidebar-link">loadApp åŠ è½½å¾®åº”ç”¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/qiankun/core/loader/#ç›®å½•" class="sidebar-link">ç›®å½•</a></li><li class="sidebar-sub-header level2"><a href="/qiankun/core/loader/#loadapp" class="sidebar-link">loadApp</a></li><li class="sidebar-sub-header level2"><a href="/qiankun/core/loader/#æ‰©å±•" class="sidebar-link">æ‰©å±•</a></li><li class="sidebar-sub-header level2"><a href="/qiankun/core/loader/#ä¸€äº›æŠ€å·§" class="sidebar-link">ä¸€äº›æŠ€å·§</a></li><li class="sidebar-sub-header level2"><a href="/qiankun/core/loader/#è·å–åŸç”Ÿçš„-window" class="sidebar-link">è·å–åŸç”Ÿçš„ window</a></li></ul></li><li><a href="/qiankun/core/effects/" class="sidebar-link">Effects</a></li><li><a href="/qiankun/core/prefetch/" class="sidebar-link">prefetch</a></li><li><a href="/qiankun/core/globalState/" class="sidebar-link">globalState</a></li><li><a href="/qiankun/core/addon/" class="sidebar-link">addon</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>sandbox</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/qiankun/import-html-entry/" class="sidebar-link">import-html-entry åŸç†</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>axios</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>solid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>viteæºç </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>jqueryæºç </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>snabbdom</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>am-editor</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>html2canvas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>express</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>acornæºç </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>immutable.jsæºç </span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-e1efabd0><div class="articleInfo" data-v-e1efabd0><ul class="breadcrumbs" data-v-e1efabd0><li data-v-e1efabd0><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-e1efabd0></a></li> <li data-v-e1efabd0><a href="/web/#web" data-v-e1efabd0>web</a></li><li data-v-e1efabd0><a href="/web/#qiankunæºç " data-v-e1efabd0>qiankunæºç </a></li><li data-v-e1efabd0><a href="/web/#core" data-v-e1efabd0>core</a></li></ul> <div class="info" data-v-e1efabd0><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-e1efabd0><a href="https://github.com/jonsam-ng" target="_blank" title="ä½œè€…" class="beLink" data-v-e1efabd0>jonsam</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-e1efabd0><a href="javascript:;" data-v-e1efabd0>2022-04-14</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">loadApp åŠ è½½å¾®åº”ç”¨<!----></h1>  <div class="theme-vdoing-content content__default"><div class="badge-group" data-v-ac1337e0><span class="group-tag" data-v-ac1337e0>æ ‡ç­¾ï¼š</span> <span class="badge tip" style="vertical-align:top;" data-v-ac1337e0 data-v-4f7c9f45>æ ¸å¿ƒ</span></div> <!----> <h2 id="ç›®å½•"><a href="#ç›®å½•" class="header-anchor">#</a> ç›®å½•</h2> <p></p><div class="table-of-contents"><ul><li><a href="#ç›®å½•">ç›®å½•</a></li><li><a href="#loadapp">loadApp</a><ul><li><a href="#createelement">createElement</a></li><li><a href="#exechookschain">execHooksChain</a></li><li><a href="#getrender">getRender</a></li><li><a href="#getlifecyclesfromexports">getLifecyclesFromExports</a></li></ul></li><li><a href="#æ‰©å±•">æ‰©å±•</a><ul><li><a href="#umd">UMD</a></li></ul></li><li><a href="#ä¸€äº›æŠ€å·§">ä¸€äº›æŠ€å·§</a><ul><li><a href="#ç”Ÿæˆå”¯ä¸€-id-çš„æ€è·¯">ç”Ÿæˆå”¯ä¸€ id çš„æ€è·¯</a></li></ul></li><li><a href="#è·å–åŸç”Ÿçš„-window">è·å–åŸç”Ÿçš„ window</a></li></ul></div><p></p> <h2 id="loadapp"><a href="#loadapp" class="header-anchor">#</a> loadApp</h2> <p>åœ¨ <a href="/30.web/6.qiankunæºç /10.core/apis.html">æ ¸å¿ƒ API</a> ä¸­å·²ç»åˆ†æè¿‡ï¼ŒloadApp è¿™ä¸ªå‡½æ•°ä¼šåœ¨ registerMicroAppsã€loadMicroApp ä¸¤ä¸ªå‡½æ•°ä¸­è°ƒç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦ä¿è¯  loadApp åœ¨ä¸»ç¨‹åº start æ‰§è¡Œä¹‹ååœ¨æ‰§è¡Œï¼Œä» s-spa çš„è§’åº¦æ¥è¯´ä¹Ÿå°±æ˜¯ startSingleSpa ä¹‹åæ‰§è¡Œã€‚ä¸»ç¨‹åºçš„ start å¹¶ä¸æ˜¯ä¸€å®šå¾—åœ¨æ³¨å†Œå¾®åº”ç”¨ä¹‹åç«‹å³å¼€å¯ï¼Œä¸»ç¨‹åº start çš„æœºä¼šæœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯ start å‡½æ•°å’Œ loadMicroApp å‡½æ•°ã€‚</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// src/loader.ts</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">loadApp</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> ObjectType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  <span class="token comment">// å¾®åº”ç”¨é…ç½®</span>
  app<span class="token operator">:</span> LoadableApp<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token comment">// ä¸»ç¨‹åºé…ç½®</span>
  configuration<span class="token operator">:</span> FrameworkConfiguration <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ä¸»ç¨‹åºç”Ÿå‘½å‘¨æœŸé’©å­</span>
  lifeCycles<span class="token operator">?</span><span class="token operator">:</span> FrameworkLifeCycles<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>ParcelConfigObjectGetter<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> entry<span class="token punctuation">,</span> name<span class="token operator">:</span> appName <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">;</span>
  <span class="token comment">// é€šè¿‡å¾®åº”ç”¨åç§°æ‰¾åˆ°å¾®åº”ç”¨å®ä¾‹ id</span>
  <span class="token keyword">const</span> appInstanceId <span class="token operator">=</span> <span class="token function">genAppInstanceIdByName</span><span class="token punctuation">(</span>appName<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    singular <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    sandbox <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    excludeAssetFilter<span class="token punctuation">,</span>
    globalContext <span class="token operator">=</span> window<span class="token punctuation">,</span>
    <span class="token operator">...</span>importEntryOpts
  <span class="token punctuation">}</span> <span class="token operator">=</span> configuration<span class="token punctuation">;</span>
  <span class="token comment">// é€šè¿‡ import-html-entry.importEntry è·å–åˆ°æ¨¡æ¿ï¼Œentry æ˜¯å¾®åº”ç”¨çš„åœ°å€ï¼ŒimportEntryOpts æ˜¯è·å–æ¨¡æ¿æ—¶çš„é…ç½®</span>
  <span class="token comment">// get the entry html content and script executor</span>
  <span class="token comment">// templateï¼š Processed HTML template.</span>
  <span class="token comment">// execScriptsï¼š(sandbox?: object, strictGlobal?: boolean, execScriptsHooks?: ExecScriptsHooks): Promise&lt;unknown&gt; - the return value is the last property on window or proxy window which set by the entry script.</span>
  <span class="token comment">// assetPublicPathï¼šPublic path for assets.</span>
  <span class="token comment">// see https://github.com/kuitos/import-html-entry#execscriptsentry-scripts-proxy-opts</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> template<span class="token punctuation">,</span> execScripts<span class="token punctuation">,</span> assetPublicPath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">importEntry</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> importEntryOpts<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// as single-spa load and bootstrap new app parallel with other apps unmounting</span>
  <span class="token comment">// (see https://github.com/CanopyTax/single-spa/blob/master/src/navigation/reroute.js#L74)</span>
  <span class="token comment">// we need wait to load the app until all apps are finishing unmount in singular mode</span>
  <span class="token comment">// singular æ”¯æŒä¼ å‡½æ•°ï¼Œæ‰€ä»¥è¿™é‡Œåˆ¤æ–­æœ€ç»ˆæ˜¯å¦å¼€å¯ singular</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">validateSingularMode</span><span class="token punctuation">(</span>singular<span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// singularæ¨¡å¼ä¸­ï¼Œç”±äº s-spa ä¸­åŠ è½½æ–°åº”ç”¨å’Œå¸è½½å…¶ä»–åº”ç”¨æ—¶åŒæ—¶è¿›è¡Œçš„ï¼Œæ‰€ä»¥éœ€è¦ç­‰å…¶ä»–åº”ç”¨å¸è½½å®Œæ¯•</span>
    <span class="token keyword">await</span> <span class="token punctuation">(</span>prevAppUnmountedDeferred <span class="token operator">&amp;&amp;</span> prevAppUnmountedDeferred<span class="token punctuation">.</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ç”Ÿæˆå³å°†è¦æ’å…¥åˆ°å®¹å™¨ä¸­çš„ç»“æ„ï¼Œæ³¨æ„è¿™é‡Œä½¿ç”¨äº† Curry Function</span>
  <span class="token comment">// see https://jonsam.site/2021/09/01/js-tricks1/  Curry Function</span>
  <span class="token keyword">const</span> appContent <span class="token operator">=</span> <span class="token function">getDefaultTplWrapper</span><span class="token punctuation">(</span>appInstanceId<span class="token punctuation">)</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æ˜¯å¦é…ç½®äº† strictStyleIsolationï¼Œå¦‚æœé…ç½®ä¸º trueï¼Œåˆ™ä½¿ç”¨ ShadowDOM</span>
  <span class="token comment">// è¿™ç§æ–¹æ³•æœ‰è¾ƒå¤§çš„å±€é™æ€§ï¼Œsee https://qiankun.umijs.org/zh/api#startopts sandbox</span>
  <span class="token keyword">const</span> strictStyleIsolation <span class="token operator">=</span> <span class="token keyword">typeof</span> sandbox <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span>sandbox<span class="token punctuation">.</span>strictStyleIsolation<span class="token punctuation">;</span>

  <span class="token comment">// æ˜¯å¦ä½¿ç”¨ experimentalStyleIsolationï¼ˆåŸºäºæ ·å¼å‰ç¼€ï¼‰ï¼Œè€Œé shadowDOM çš„æ ·å¼æ²™ç®±</span>
  <span class="token keyword">const</span> scopedCSS <span class="token operator">=</span> <span class="token function">isEnableScopedCSS</span><span class="token punctuation">(</span>sandbox<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// åˆ›å»ºå¾…æ’å…¥çš„DOMèŠ‚ç‚¹å…ƒç´ </span>
  <span class="token keyword">let</span> initialAppWrapperElement<span class="token operator">:</span> HTMLElement <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>
    appContent<span class="token punctuation">,</span>
    strictStyleIsolation<span class="token punctuation">,</span>
    scopedCSS<span class="token punctuation">,</span>
    appInstanceId<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> initialContainer <span class="token operator">=</span> <span class="token string">'container'</span> <span class="token keyword">in</span> app <span class="token operator">?</span> app<span class="token punctuation">.</span>container <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> legacyRender <span class="token operator">=</span> <span class="token string">'render'</span> <span class="token keyword">in</span> app <span class="token operator">?</span> app<span class="token punctuation">.</span>render <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token comment">// è·å–æ¸²æŸ“ç­–ç•¥</span>
  <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">getRender</span><span class="token punctuation">(</span>appInstanceId<span class="token punctuation">,</span> appContent<span class="token punctuation">,</span> legacyRender<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ç¬¬ä¸€æ¬¡åŠ è½½è®¾ç½®åº”ç”¨å¯è§åŒºåŸŸ dom ç»“æ„</span>
  <span class="token comment">// ç¡®ä¿æ¯æ¬¡åº”ç”¨åŠ è½½å‰å®¹å™¨ dom ç»“æ„å·²ç»è®¾ç½®å®Œæ¯•</span>
  <span class="token comment">// æ¸²æŸ“æ¨¡æ¿æ–‡ä»¶åˆ°å®¹å™¨ä¸­ï¼Œåˆå§‹åŒ–å¾®åº”ç”¨çš„ DOM ç»“æ„</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span> element<span class="token operator">:</span> initialAppWrapperElement<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> container<span class="token operator">:</span> initialContainer <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'loading'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ç”Ÿæˆè·å–å¾®åº”ç”¨èŠ‚ç‚¹çš„æ–¹æ³•</span>
  <span class="token keyword">const</span> initialAppWrapperGetter <span class="token operator">=</span> <span class="token function">getAppWrapperGetter</span><span class="token punctuation">(</span>
    appInstanceId<span class="token punctuation">,</span>
    <span class="token operator">!</span><span class="token operator">!</span>legacyRender<span class="token punctuation">,</span>
    strictStyleIsolation<span class="token punctuation">,</span>
    scopedCSS<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> initialAppWrapperElement<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æ‹·è´ globalContextï¼Œä»¥å…æ±¡æŸ“ window</span>
  <span class="token keyword">let</span> global <span class="token operator">=</span> globalContext<span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token function-variable function">mountSandbox</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token function-variable function">unmountSandbox</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æ˜¯å¦ä½¿ç”¨ loose æ¨¡å¼çš„æ²™ç®±</span>
  <span class="token keyword">const</span> useLooseSandbox <span class="token operator">=</span> <span class="token keyword">typeof</span> sandbox <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span>sandbox<span class="token punctuation">.</span>loose<span class="token punctuation">;</span>
  <span class="token keyword">let</span> sandboxContainer<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sandbox<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºæ²™ç®±å®¹å™¨</span>
    sandboxContainer <span class="token operator">=</span> <span class="token function">createSandboxContainer</span><span class="token punctuation">(</span>
      appInstanceId<span class="token punctuation">,</span>
      <span class="token comment">// FIXME should use a strict sandbox logic while remount, see https://github.com/umijs/qiankun/issues/518</span>
      initialAppWrapperGetter<span class="token punctuation">,</span>
      scopedCSS<span class="token punctuation">,</span>
      useLooseSandbox<span class="token punctuation">,</span>
      <span class="token comment">// æ²™ç®±èµ„æºç™½åå•è¿‡æ»¤å™¨</span>
      excludeAssetFilter<span class="token punctuation">,</span>
      global<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–åˆ°æ²™ç®±ä¸­çš„å…¨å±€ä»£ç†å¯¹è±¡ï¼Œmount æ–¹æ³•å’Œ unmount æ–¹æ³•</span>
    <span class="token comment">// ç”¨æ²™ç®±çš„ä»£ç†å¯¹è±¡ä½œä¸ºæ¥ä¸‹æ¥ä½¿ç”¨çš„å…¨å±€å¯¹è±¡</span>
    global <span class="token operator">=</span> sandboxContainer<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>proxy <span class="token keyword">as</span> <span class="token keyword">typeof</span> window<span class="token punctuation">;</span>
    mountSandbox <span class="token operator">=</span> sandboxContainer<span class="token punctuation">.</span>mount<span class="token punctuation">;</span>
    unmountSandbox <span class="token operator">=</span> sandboxContainer<span class="token punctuation">.</span>unmount<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> beforeUnmount <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> afterUnmount <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> afterMount <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> beforeMount <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> beforeLoad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span>
    <span class="token comment">// mergeWithï¼š This method is like _.merge except that it accepts customizer which is invoked to produce the merged values of the destination and source properties. If customizer returns undefined merging is handled by the method instead.</span>
    <span class="token comment">// see https://lodash.com/docs/4.17.15#mergeWith</span>
    <span class="token comment">// concatï¼š Creates a new array concatenating array with any additional arrays and/or values.</span>
    <span class="token comment">// åˆå¹¶å†…éƒ¨æ’ä»¶ä¸­ä½¿ç”¨çš„ç”Ÿå‘½å‘¨æœŸå’Œç”¨æˆ·ä¼ å…¥çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒ</span>
    <span class="token function">mergeWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">getAddOns</span><span class="token punctuation">(</span>global<span class="token punctuation">,</span> assetPublicPath<span class="token punctuation">)</span><span class="token punctuation">,</span> lifeCycles<span class="token punctuation">,</span> <span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">concat</span><span class="token punctuation">(</span>v1 <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v2 <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æ‰§è¡Œæ‰€æœ‰ beforeLoad çš„é’©å­é“¾ï¼Œå› ä¸ºå½“å‰å¤„äº beforeLoad é˜¶æ®µ</span>
  <span class="token keyword">await</span> <span class="token function">execHooksChain</span><span class="token punctuation">(</span><span class="token function">toArray</span><span class="token punctuation">(</span>beforeLoad<span class="token punctuation">)</span><span class="token punctuation">,</span> app<span class="token punctuation">,</span> global<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// get the lifecycle hooks from module exports</span>
  <span class="token comment">// æ‰§è¡Œæ¨¡æ¿ä¸­çš„ js æ–‡ä»¶ï¼Œæ‰§è¡Œ js çš„æ²™ç®±ä¸º globalï¼Œå¦‚æœä½¿ç”¨ lose æ¨¡å¼çš„æ²™ç®±å°±ä¸ä½¿ç”¨ä¸¥æ ¼çš„ js æ²™ç®±ã€‚</span>
  <span class="token comment">// scriptExports ä¸ºæ‰§è¡Œ js ä¹‹åçš„ç»“æœï¼Œå¾®åº”ç”¨ä¸­çš„ js é€šå¸¸æ‰“åŒ…ä¸º umd</span>
  <span class="token comment">// å¦‚æœä»£ç é¦–æ¬¡æ‰§è¡Œæä¾›äº†æ²™ç®±ï¼Œä¹‹åä»£ç åœ¨è¿è¡Œæ—¶ä¸­éƒ½ä¼šåœ¨æ²™ç®±ä¸­è¿è¡Œ</span>
  <span class="token keyword">const</span> scriptExports<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">execScripts</span><span class="token punctuation">(</span>global<span class="token punctuation">,</span> sandbox <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>useLooseSandbox<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ä»å¾®åº”ç”¨ä¸­è·å–åˆ°ç›¸å…³çš„é’©å­å‡½æ•°</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> bootstrap<span class="token punctuation">,</span> mount<span class="token punctuation">,</span> unmount<span class="token punctuation">,</span> update <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getLifecyclesFromExports</span><span class="token punctuation">(</span>
    scriptExports<span class="token punctuation">,</span>
    appName<span class="token punctuation">,</span>
    global<span class="token punctuation">,</span>
    <span class="token comment">// ä¹‹æ‰€ä»¥è¦ä½¿ç”¨ æ²™ç®±ä¸Šçš„latestSetPropï¼Œæ˜¯å› ä¸º execScripts å¯èƒ½ä¼šåœ¨å¾—åˆ°å…¥å£è„šæœ¬çš„æ‰§è¡Œè¿‡ç¨‹ä¸­å°†ç»“æœè®¾ç½®åˆ° global ä¸Šï¼Œå¦‚æœæ˜¯ä»£ç†æ²™ç®±ï¼Œè¿™ä¸ªè¡Œä¸ºå¯ä»¥è¢«è®°å½•ä¸‹æ¥ï¼Œå­˜æ”¾åˆ° instance?.latestSetProp ä¸Šã€‚å‚è€ƒ UMD æ¨¡å—åŒ–ã€‚</span>
    sandboxContainer<span class="token operator">?.</span>instance<span class="token operator">?.</span>latestSetProp<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å·¥å‚æ–¹æ³•ï¼šåˆ›å»ºå½“å‰å¾®åº”ç”¨çš„å…¨å±€çŠ¶æ€ä¾èµ–ç®¡ç†å·¥å…·å‡½æ•°ï¼Œæ‰€æœ‰å¾®åº”ç”¨çš„å…¨å±€ä¾èµ–å­˜æ”¾åœ¨ globalState æ–‡ä»¶ä¸­çš„ deps ä¸­ã€‚</span>
  <span class="token comment">// è¿™é‡Œé€šè¿‡ appInstanceId ä¸ºå½“å‰å¾®åº”ç”¨åˆ›å»ºå•ç‹¬çš„ä¾èµ–å·¥å…·æ˜¯åˆ©ç”¨å·¥å‚æ¨¡å¼æå‡è¿è¡Œæ•ˆç‡ï¼ŒåŒæ—¶å¯ä»¥éšè— appInstanceIdï¼Œå°¤å…¶æ˜¯æš´éœ²ç»™å¤–ç•Œ global çš„idï¼Œä½“ç°å…¶å°è£…æ€§</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> onGlobalStateChange<span class="token punctuation">,</span> setGlobalState<span class="token punctuation">,</span> offGlobalStateChange <span class="token punctuation">}</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> CallableFunction<span class="token operator">&gt;</span> <span class="token operator">=</span>
    <span class="token function">getMicroAppStateActions</span><span class="token punctuation">(</span>appInstanceId<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// FIXME temporary way</span>
  <span class="token keyword">const</span> <span class="token function-variable function">syncAppWrapperElement2Sandbox</span> <span class="token operator">=</span> <span class="token punctuation">(</span>element<span class="token operator">:</span> HTMLElement <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>initialAppWrapperElement <span class="token operator">=</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// container æ˜¯å¯é€‰çš„ï¼Œæœ‰é»˜è®¤å€¼</span>
  <span class="token comment">// loadApp è¿”å› parcelConfigGetterï¼Œé€šè¿‡ container åŠ¨æ€åˆ›å»ºä¼ é€’ç»™ s-spa çš„é…ç½®ã€‚</span>
  <span class="token comment">// è¿™é‡Œå€Ÿé‰´äº† curry function çš„æ€æƒ³</span>
  <span class="token keyword">const</span> parcelConfigGetter<span class="token operator">:</span> <span class="token function-variable function">ParcelConfigObjectGetter</span> <span class="token operator">=</span> <span class="token punctuation">(</span>remountContainer <span class="token operator">=</span> initialContainer<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> appWrapperElement<span class="token operator">:</span> HTMLElement <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> appWrapperGetter<span class="token operator">:</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> getAppWrapperGetter<span class="token operator">&gt;</span><span class="token punctuation">;</span>

    <span class="token comment">// åŠ¨æ€åˆ›å»º s-spa.mountRootParcel çš„é…ç½®</span>
    <span class="token keyword">const</span> parcelConfig<span class="token operator">:</span> ParcelConfigObject <span class="token operator">=</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> appInstanceId<span class="token punctuation">,</span>
      <span class="token comment">// bootstrap, mount, unmount, update æ˜¯ä»å¾®åº”ç”¨ä¸­è·å–åˆ°çš„é’©å­å‡½æ•°</span>
      bootstrap<span class="token punctuation">,</span>
      <span class="token comment">// æ³¨æ„è¿™é‡Œ mount ä¸­å„ä¸ªé’©å­å‡½æ•°éƒ½æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼ˆasyncï¼‰ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯é’©å­çš„æ‰§è¡Œé¡ºåºï¼ŒåŒæ—¶ä¹Ÿæ˜¯å› ä¸º s-spa æ— æ³•ç¡®ä¿å¤–éƒ¨çš„é’©å­æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥ç»Ÿä¸€ä½¿ç”¨ï¼ˆawaitï¼‰å¤„ç†ã€‚</span>
      mount<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// å¦‚æœæ˜¯ singular æ¨¡å¼ï¼Œç­‰å¾…ä¹‹å‰çš„å¾®åº”ç”¨å¸è½½å®Œæ¯•</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">validateSingularMode</span><span class="token punctuation">(</span>singular<span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> prevAppUnmountedDeferred<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> prevAppUnmountedDeferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// initial wrapper element before app mount/remount</span>
        <span class="token comment">// é‡æ–°åˆå§‹åŒ–å†…éƒ¨çš„å®¹å™¨èŠ‚ç‚¹å’Œå®¹å™¨ getter æ–¹æ³•</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          appWrapperElement <span class="token operator">=</span> initialAppWrapperElement<span class="token punctuation">;</span>
          appWrapperGetter <span class="token operator">=</span> <span class="token function">getAppWrapperGetter</span><span class="token punctuation">(</span>
            appInstanceId<span class="token punctuation">,</span>
            <span class="token operator">!</span><span class="token operator">!</span>legacyRender<span class="token punctuation">,</span>
            strictStyleIsolation<span class="token punctuation">,</span>
            scopedCSS<span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> appWrapperElement<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// æ·»åŠ  mount hook, ç¡®ä¿æ¯æ¬¡åº”ç”¨åŠ è½½å‰å®¹å™¨ dom ç»“æ„å·²ç»è®¾ç½®å®Œæ¯•</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> useNewContainer <span class="token operator">=</span> remountContainer <span class="token operator">!==</span> initialContainer<span class="token punctuation">;</span>
          <span class="token comment">// å¦‚æœå®¹å™¨èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œå¯èƒ½æ˜¯å·²ç»è¢«å¸è½½äº†ï¼Œåˆ™é‡æ–°åˆ›å»ºå®¹å™¨èŠ‚ç‚¹ï¼Œå¹¶ä¸”ç¼“å­˜åˆ° initialAppWrapperElement</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>useNewContainer <span class="token operator">||</span> <span class="token operator">!</span>appWrapperElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// element will be destroyed after unmounted, we need to recreate it if it not exist</span>
            <span class="token comment">// or we try to remount into a new container</span>
            appWrapperElement <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>appContent<span class="token punctuation">,</span> strictStyleIsolation<span class="token punctuation">,</span> scopedCSS<span class="token punctuation">,</span> appInstanceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">syncAppWrapperElement2Sandbox</span><span class="token punctuation">(</span>appWrapperElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// ç¡®ä¿æ¨¡æ¿ä¸­ dom ç»“æ„å·²ç»æ¸²æŸ“å®Œæ¯•ï¼ŒçŠ¶æ€ä¸º mounting</span>
          <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span> element<span class="token operator">:</span> appWrapperElement<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> container<span class="token operator">:</span> remountContainer <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'mounting'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// æ‰§è¡Œæ²™ç®±ä¸­çš„ mount é’©å­ï¼Œåˆå§‹åŒ–æ²™ç®±ç¯å¢ƒ</span>
        mountSandbox<span class="token punctuation">,</span>
        <span class="token comment">// æ‰§è¡Œæ’ä»¶å’Œç”¨æˆ·è‡ªå®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­ beforeMount</span>
        <span class="token comment">// exec the chain after rendering to keep the behavior with beforeLoad</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">execHooksChain</span><span class="token punctuation">(</span><span class="token function">toArray</span><span class="token punctuation">(</span>beforeMount<span class="token punctuation">)</span><span class="token punctuation">,</span> app<span class="token punctuation">,</span> global<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// æ”¶é›† s-spa çš„å›è°ƒå‚æ•°å’Œå†…éƒ¨çš„å‚æ•°ï¼Œä¼ é€’ç»™å¾®åº”ç”¨çš„ mount é’©å­ï¼Œæ‰§è¡Œå¾®åº”ç”¨çš„ mount é’©å­ï¼Œæ³¨æ„è¿™é‡Œçš„ setGlobalState å’Œ onGlobalStateChange æ˜¯å½“å‰å¾®åº”ç”¨å¯¹å…¨å±€çŠ¶æ€ç›‘å¬çš„å‰¯ä½œç”¨</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>props<span class="token punctuation">,</span> container<span class="token operator">:</span> <span class="token function">appWrapperGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> setGlobalState<span class="token punctuation">,</span> onGlobalStateChange <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// finish loading after app mounted</span>
        <span class="token comment">// æ¸²æŸ“æ¨¡æ¿ DOMï¼Œ çŠ¶æ€ä¸º mounted</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span> element<span class="token operator">:</span> appWrapperElement<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> container<span class="token operator">:</span> remountContainer <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'mounted'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// æ‰§è¡Œæ’ä»¶å’Œç”¨æˆ·è‡ªå®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­ afterMount</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">execHooksChain</span><span class="token punctuation">(</span><span class="token function">toArray</span><span class="token punctuation">(</span>afterMount<span class="token punctuation">)</span><span class="token punctuation">,</span> app<span class="token punctuation">,</span> global<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// initialize the unmount defer after app mounted and resolve the defer after it unmounted</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">validateSingularMode</span><span class="token punctuation">(</span>singular<span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// åº”ç”¨å·²ç» mountï¼Œåˆå§‹åŒ– prevAppUnmountedDeferred</span>
            prevAppUnmountedDeferred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Deferred<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      unmount<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// æ‰§è¡Œæ’ä»¶å’Œç”¨æˆ·è‡ªå®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­ beforeUnmount</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">execHooksChain</span><span class="token punctuation">(</span><span class="token function">toArray</span><span class="token punctuation">(</span>beforeUnmount<span class="token punctuation">)</span><span class="token punctuation">,</span> app<span class="token punctuation">,</span> global<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// æ”¶é›†å±æ€§è°ƒç”¨å¾®åº”ç”¨çš„é’©å­ unmount</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>props<span class="token punctuation">,</span> container<span class="token operator">:</span> <span class="token function">appWrapperGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// å¸è½½æ²™ç®±</span>
        unmountSandbox<span class="token punctuation">,</span>
        <span class="token comment">// æ‰§è¡Œæ’ä»¶å’Œç”¨æˆ·è‡ªå®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­ afterUnmount</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">execHooksChain</span><span class="token punctuation">(</span><span class="token function">toArray</span><span class="token punctuation">(</span>afterUnmount<span class="token punctuation">)</span><span class="token punctuation">,</span> app<span class="token punctuation">,</span> global<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// æ¸²æŸ“æ¨¡æ¿ï¼ŒçŠ¶æ€ä¸º unmounted</span>
          <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span> element<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> container<span class="token operator">:</span> remountContainer <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'unmounted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// å¸è½½å…¨å±€çŠ¶æ€ç›‘å¬effect</span>
          <span class="token function">offGlobalStateChange</span><span class="token punctuation">(</span>appInstanceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// é‡ç½® appWrapperElement å’Œ initialAppWrapperElement</span>
          <span class="token comment">// for gc</span>
          appWrapperElement <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
          <span class="token function">syncAppWrapperElement2Sandbox</span><span class="token punctuation">(</span>appWrapperElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">validateSingularMode</span><span class="token punctuation">(</span>singular<span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> prevAppUnmountedDeferred<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// unmount æ‰§è¡Œå®Œæ¯•ï¼Œresolve prevAppUnmountedDeferred</span>
            prevAppUnmountedDeferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœéœ€è¦èƒ½æ”¯æŒä¸»åº”ç”¨æ‰‹åŠ¨ update å¾®åº”ç”¨ï¼Œéœ€è¦å¾®åº”ç”¨ entry å†å¤šå¯¼å‡ºä¸€ä¸ª update é’©å­</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> update <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      parcelConfig<span class="token punctuation">.</span>update <span class="token operator">=</span> update<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> parcelConfig<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> parcelConfigGetter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br></div></div><p>å‡½æ•°çš„æ ¸å¿ƒä½œç”¨ï¼š</p> <ul><li>è·å–æ¨¡æ¿ã€æ¸²æŸ“æ¨¡æ¿èŠ‚ç‚¹ï¼Œæ‰§è¡Œæ¨¡æ¿è„šæœ¬è·å–å¾®åº”ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå¹¶ä¸”åœ¨ s-spa çš„ç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨ã€‚</li> <li>åˆå§‹åŒ–æ²™ç®±ï¼Œå¹¶ä¸”åœ¨å¾®åº”ç”¨ mount å’Œ unmount æ—¶æŒ‚è½½å’Œå¸è½½æ²™ç®±ã€‚</li> <li>ç»´æŠ¤å¾®åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€æ‰§è¡Œæ’ä»¶åœ¨ç”Ÿå‘½å‘¨æœŸçš„å›è°ƒå’Œç”¨æˆ·è‡ªå®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸçš„å›è°ƒã€‚</li> <li>æ”¶é›†å¾®åº”ç”¨ç›‘å¬å…¨å±€çŠ¶æ€çš„ effectã€‚</li></ul> <h3 id="createelement"><a href="#createelement" class="header-anchor">#</a> createElement</h3> <p>createElement åˆ›å»ºæ¨¡æ¿èŠ‚ç‚¹ã€‚</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> supportShadowDOM <span class="token operator">=</span> document<span class="token punctuation">.</span>head<span class="token punctuation">.</span>attachShadow <span class="token operator">||</span> document<span class="token punctuation">.</span>head<span class="token punctuation">.</span>createShadowRoot<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span>
  appContent<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  strictStyleIsolation<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>
  scopedCSS<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>
  appInstanceId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">:</span> HTMLElement <span class="token punctuation">{</span>
  <span class="token keyword">const</span> containerElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  containerElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> appContent<span class="token punctuation">;</span>
  <span class="token comment">// appContent always wrapped with a singular div</span>
  <span class="token keyword">const</span> appElement <span class="token operator">=</span> containerElement<span class="token punctuation">.</span>firstChild <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>strictStyleIsolation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>supportShadowDOM<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">'[qiankun]: As current browser not support shadow dom, your strictStyleIsolation configuration will be ignored!'</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> innerHTML <span class="token punctuation">}</span> <span class="token operator">=</span> appElement<span class="token punctuation">;</span>
      appElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> shadow<span class="token operator">:</span> ShadowRoot<span class="token punctuation">;</span>
      <span class="token comment">// attachShadow æ˜¯ shadowDOM v1 è§„èŒƒ</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>appElement<span class="token punctuation">.</span>attachShadow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä½¿ç”¨ shadowDOM</span>
        shadow <span class="token operator">=</span> appElement<span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mode<span class="token operator">:</span> <span class="token string">'open'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// createShadowRoot æ˜¯ shadowDOM v0 è§„èŒƒï¼Œå·²ç»åºŸå¼ƒ</span>
        <span class="token comment">// createShadowRoot was proposed in initial spec, which has then been deprecated</span>
        shadow <span class="token operator">=</span> <span class="token punctuation">(</span>appElement <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createShadowRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      shadow<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> innerHTML<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>scopedCSS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> attr <span class="token operator">=</span> appElement<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>css<span class="token punctuation">.</span>QiankunCSSRewriteAttr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>attr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      appElement<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>css<span class="token punctuation">.</span>QiankunCSSRewriteAttr<span class="token punctuation">,</span> appInstanceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœé‡‡ç”¨äº† scopedCSSï¼Œè·å– appElement ä¸Šæ‰€æœ‰çš„æ ·å¼å¹¶ä¸”åŠ ä¸Šæ ·å¼å‰ç¼€</span>
    <span class="token keyword">const</span> styleNodes <span class="token operator">=</span> appElement<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">forEach</span><span class="token punctuation">(</span>styleNodes<span class="token punctuation">,</span> <span class="token punctuation">(</span>stylesheetElement<span class="token operator">:</span> HTMLStyleElement<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      css<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>appElement<span class="token operator">!</span><span class="token punctuation">,</span> stylesheetElement<span class="token punctuation">,</span> appInstanceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> appElement<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><ul><li>é…ç½®äº† strictStyleIsolationï¼Œä½¿ç”¨ shadowDOM éš”ç¦»æ ·å¼ã€‚</li> <li>é…ç½®äº† scopedCSSï¼Œä½¿ç”¨æ ·å¼å‰ç¼€éš”ç¦»æ ·å¼ã€‚</li></ul> <h3 id="exechookschain"><a href="#exechookschain" class="header-anchor">#</a> execHooksChain</h3> <p>execHooksChain æ‰§è¡Œé’©å­é›†åˆã€‚</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">execHooksChain</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> ObjectType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  hooks<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>LifeCycleFn<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
  app<span class="token operator">:</span> LoadableApp<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  global <span class="token operator">=</span> window<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hooks<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> hooks<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>chain<span class="token punctuation">,</span> hook<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> chain<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">hook</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> global<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>execHooksChain æ‰§è¡Œé“¾å¼çš„è¿”å› Promise çš„é’©å­å‡½æ•°ï¼Œè¿™é‡Œç”¨çš„å¾ˆå·§å¦™ï¼Œåˆå§‹åŒ–ä¸ºç©ºçš„ Promiseï¼Œåœ¨ Promise.then ä¸­æ‰§è¡Œ hookã€‚ <code>Promise.resolve().then(() =&gt; {})</code>  è¿”å›ä¸€ä¸ª Promiseï¼Œä¿ƒä½¿ reduce ç»§ç»­æ‰§è¡Œã€‚è€Œä¸”ï¼Œæ¯ä¸ª hook éƒ½åœ¨å¾®ä»»åŠ¡ä¸­æ‰§è¡Œï¼ŒçŸ¥é“æœ€åä¸€ä¸ª hook æ‰§è¡Œè¿”å› promiseã€‚</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * Represents the completion of an asynchronous operation
 */</span>
<span class="token keyword">interface</span> <span class="token class-name"><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * Attaches callbacks for the resolution and/or rejection of the Promise.
     * @param onfulfilled The callback to execute when the Promise is resolved.
     * @param onrejected The callback to execute when the Promise is rejected.
     * @returns A Promise for the completion of which ever callback is executed.
     */</span>
    <span class="token generic-function"><span class="token function">then</span><span class="token generic class-name"><span class="token operator">&lt;</span>TResult1 <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">,</span> TResult2 <span class="token operator">=</span> <span class="token builtin">never</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>onfulfilled<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TResult1 <span class="token operator">|</span> PromiseLike<span class="token operator">&lt;</span>TResult1<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> onrejected<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>reason<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TResult2 <span class="token operator">|</span> PromiseLike<span class="token operator">&lt;</span>TResult2<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>TResult1 <span class="token operator">|</span> TResult2<span class="token operator">&gt;</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Attaches a callback for only the rejection of the Promise.
     * @param onrejected The callback to execute when the Promise is rejected.
     * @returns A Promise for the completion of the callback.
     */</span>
    <span class="token keyword">catch</span><span class="token operator">&lt;</span>TResult <span class="token operator">=</span> <span class="token builtin">never</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>onrejected<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>reason<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TResult <span class="token operator">|</span> PromiseLike<span class="token operator">&lt;</span>TResult<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">|</span> TResult<span class="token operator">&gt;</span><span class="token punctuation">;</span>
     <span class="token comment">/**
     * Attaches a callback that is invoked when the Promise is settled (fulfilled or rejected). The
     * resolved value cannot be modified from the callback.
     * @param onfinally The callback to execute when the Promise is settled (fulfilled or rejected).
     * @returns A Promise for the completion of the callback.
     */</span>
    <span class="token function">finally</span><span class="token punctuation">(</span>onfinally<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">|</span> TResult<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>ä»¥ä¸Šæ˜¯ Promise ç±»å‹å®šä¹‰ï¼Œthenã€catchã€finally è¿”å›çš„éƒ½æ˜¯ Promiseã€‚</p> <h3 id="getrender"><a href="#getrender" class="header-anchor">#</a> getRender</h3> <p>è·å–æ¸²æŸ“æ¨¡æ¿ DOM èŠ‚ç‚¹åˆ°å®¹å™¨çš„æ–¹æ³•ã€‚</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>
<span class="token keyword">const</span> rawAppendChild <span class="token operator">=</span> HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>appendChild<span class="token punctuation">;</span>
<span class="token keyword">const</span> rawRemoveChild <span class="token operator">=</span> HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>removeChild<span class="token punctuation">;</span>
<span class="token comment">/**
 * Get the render function
 * If the legacy render function is provide, used as it, otherwise we will insert the app element to target container by qiankun
 * @param appInstanceId
 * @param appContent
 * @param legacyRender
 */</span>
<span class="token keyword">function</span> <span class="token function">getRender</span><span class="token punctuation">(</span>appInstanceId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> appContent<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> legacyRender<span class="token operator">?</span><span class="token operator">:</span> HTMLContentRender<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> render<span class="token operator">:</span> <span class="token function-variable function">ElementRender</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> element<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> container <span class="token punctuation">}</span><span class="token punctuation">,</span> phase<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>legacyRender<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">legacyRender</span><span class="token punctuation">(</span><span class="token punctuation">{</span> loading<span class="token punctuation">,</span> appContent<span class="token operator">:</span> element <span class="token operator">?</span> appContent <span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è·å–å¤–éƒ¨é…ç½®çš„è¦æŒ‚è½½çš„å®¹å™¨</span>
    <span class="token keyword">const</span> containerElement <span class="token operator">=</span> <span class="token function">getContainer</span><span class="token punctuation">(</span>container<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// The container might have be removed after micro app unmounted.</span>
    <span class="token comment">// Such as the micro app unmount lifecycle called by a react componentWillUnmount lifecycle, after micro app unmounted, the react component might also be removed</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>phase <span class="token operator">!==</span> <span class="token string">'unmounted'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// è·å–ä¸åŒçŠ¶æ€çš„æŠ¥é”™ä¿¡æ¯</span>
      <span class="token keyword">const</span> errorMsg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>phase<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">case</span> <span class="token string">'loading'</span><span class="token operator">:</span>
          <span class="token keyword">case</span> <span class="token string">'mounting'</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Target container with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>container<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> not existed while </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>appInstanceId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>phase<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

          <span class="token keyword">case</span> <span class="token string">'mounted'</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Target container with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>container<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> not existed after </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>appInstanceId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>phase<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

          <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Target container with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>container<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> not existed while </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>appInstanceId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> rendering!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertElementExist</span><span class="token punctuation">(</span>containerElement<span class="token punctuation">,</span> errorMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>containerElement <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>containerElement<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ¸…ç©ºå®¹å™¨</span>
      <span class="token comment">// clear the container</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>containerElement<span class="token operator">!</span><span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">rawRemoveChild</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>containerElement<span class="token punctuation">,</span> containerElement<span class="token operator">!</span><span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// æ’å…¥å…ƒç´ </span>
      <span class="token comment">// append the element to container if it exist</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">rawAppendChild</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>containerElement<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> render<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h3 id="getlifecyclesfromexports"><a href="#getlifecyclesfromexports" class="header-anchor">#</a> getLifecyclesFromExports</h3> <p>getLifecyclesFromExports å‡½æ•°ä»å¾®åº”ç”¨ js çš„æ‰§è¡Œç»“æœé‡Œå°è¯•è·å–ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/** æ ¡éªŒå­åº”ç”¨å¯¼å‡ºçš„ ç”Ÿå‘½å‘¨æœŸ å¯¹è±¡æ˜¯å¦æ­£ç¡® */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">validateExportLifecycle</span><span class="token punctuation">(</span>exports<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> bootstrap<span class="token punctuation">,</span> mount<span class="token punctuation">,</span> unmount <span class="token punctuation">}</span> <span class="token operator">=</span> exports <span class="token operator">??</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>bootstrap<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>mount<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>unmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getLifecyclesFromExports</span><span class="token punctuation">(</span>
  scriptExports<span class="token operator">:</span> LifeCycles<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  appName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  global<span class="token operator">:</span> WindowProxy<span class="token punctuation">,</span>
  globalLatestSetProp<span class="token operator">?</span><span class="token operator">:</span> PropertyKey <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">validateExportLifecycle</span><span class="token punctuation">(</span>scriptExports<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> scriptExports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// fallback to sandbox latest set property if it had</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>globalLatestSetProp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> lifecycles <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span>global<span class="token punctuation">)</span><span class="token punctuation">[</span>globalLatestSetProp<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">validateExportLifecycle</span><span class="token punctuation">(</span>lifecycles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> lifecycles<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// fallback to global variable who named with ${appName} while module exports not found</span>
  <span class="token keyword">const</span> globalVariableExports <span class="token operator">=</span> <span class="token punctuation">(</span>global <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">[</span>appName<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">validateExportLifecycle</span><span class="token punctuation">(</span>globalVariableExports<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> globalVariableExports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">QiankunError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You need to export lifecycle functions in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>appName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> entry</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>ä¸‰ç§å°è¯•åˆ†åˆ«ä¸º scriptExportsã€ <code>global[sandboxContainer?.instance?.latestSetProp]</code>  å’Œ  <code>global[appName]</code>  ã€‚</p> <h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="header-anchor">#</a> æ‰©å±•</h2> <h3 id="umd"><a href="#umd" class="header-anchor">#</a> UMD</h3> <p>åœ¨ getLifecyclesFromExports ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº† qiankun ä¼šä»ä¸‰ä¸­æƒ…å†µè·å–å¾®åº”ç”¨ js æ‰§è¡Œç»“æœçš„ ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œè¿™ä¸ªæ­¥éª¤è‡³å…³é‡è¦ï¼Œå› ä¸º k æ¡†æ¶æœ¬èº«ä¾èµ–å¾®åº”ç”¨æœ¬èº«çš„ mountã€unmount é’©å­æŒ‚è½½å’Œå¸è½½å¾®åº”ç”¨ï¼Œå¦‚ React ä¸­çš„  <code>ReactDOM.render</code>  å’Œ Vue3 ä¸­çš„  <code>createApp().mount</code> ã€‚åœ¨æ‰“åŒ…å·¥å…·ä¸­ï¼Œé€šå¸¸å°†è¾“å‡º js æ ¼å¼è®¾ç½®ä¸º UMD æ ¼å¼ã€‚</p> <blockquote><p>UMD (Universal Module Definition), å¸Œæœ›æä¾›ä¸€ä¸ªå‰åç«¯è·¨å¹³å°çš„è§£å†³æ–¹æ¡ˆ (æ”¯æŒ AMD ä¸ CommonJS æ¨¡å—æ–¹å¼)ã€‚</p></blockquote> <p>å®ç°åŸç†:</p> <ul><li>å…ˆåˆ¤æ–­æ˜¯å¦æ”¯æŒ Node.js æ¨¡å—æ ¼å¼ï¼ˆexports æ˜¯å¦å­˜åœ¨ï¼‰ï¼Œå­˜åœ¨åˆ™ä½¿ç”¨ Node.js æ¨¡å—æ ¼å¼ã€‚</li> <li>å†åˆ¤æ–­æ˜¯å¦æ”¯æŒ AMDï¼ˆdefine æ˜¯å¦å­˜åœ¨ï¼‰ï¼Œå­˜åœ¨åˆ™ä½¿ç”¨ AMD æ–¹å¼åŠ è½½æ¨¡å—ã€‚</li> <li>å‰ä¸¤ä¸ªéƒ½ä¸å­˜åœ¨ï¼Œåˆ™å°†æ¨¡å—å…¬å¼€åˆ°å…¨å±€ï¼ˆwindow æˆ– globalï¼‰ã€‚</li></ul> <p>å„ç§å…·ä½“çš„å®ç°æ–¹å¼ï¼Œå¯ä»¥æŸ¥çœ‹ UMD çš„ githubã€‚æˆ‘è¿™é‡Œä¸¾ä¾‹ä¸€ä¸ª jQuery ä½¿ç”¨çš„ï¼ŒæŒ‰ç…§å¦‚ä¸Šæ–¹å¼å®ç°çš„ä»£ç :</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// if the module has no dependencies, the above pattern can be simplified to</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// AMD</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// AMD. Register as an anonymous module.</span>
        <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// CJS</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Node. Does not work with strict CommonJS, but</span>
        <span class="token comment">// only CommonJS-like environments that support module.exports,</span>
        <span class="token comment">// like Node.</span>
        module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// Global</span>
        <span class="token comment">// Browser globals (root is window)</span>
        root<span class="token punctuation">.</span>returnExports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Just return a value to define the module export.</span>
    <span class="token comment">// This example returns an object, but the module</span>
    <span class="token comment">// can return a function as the exported value.</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>è¿™é‡Œä½¿ç”¨äº† DIï¼ˆä¾èµ–æ³¨å…¥æ¨¡å¼ï¼‰çš„æ€æƒ³ã€‚</p> <p>å‚è€ƒï¼š</p> <ul><li><a href="https://jonsam.site/2021/12/31/javascript-module/" target="_blank" rel="noopener noreferrer">[JavaScript] Javascript æ¨¡å—åŒ–åŸºç¡€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://docs.jonsam.site/project-5/doc-354/" target="_blank" rel="noopener noreferrer">ä¾èµ–æ³¨å…¥æ¨¡å¼ï¼ˆDependency Injectionï¼‰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="ä¸€äº›æŠ€å·§"><a href="#ä¸€äº›æŠ€å·§" class="header-anchor">#</a> ä¸€äº›æŠ€å·§</h2> <h3 id="ç”Ÿæˆå”¯ä¸€-id-çš„æ€è·¯"><a href="#ç”Ÿæˆå”¯ä¸€-id-çš„æ€è·¯" class="header-anchor">#</a> ç”Ÿæˆå”¯ä¸€ id çš„æ€è·¯</h3> <p>ä¸€èˆ¬å¯¹äºéœ€è¦åˆ›å»ºå”¯ä¸€ id æ—¶ï¼Œé€šå¸¸ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼ˆUUIDï¼‰æˆ–è€…å“ˆå¸Œå€¼ï¼Œè¿˜æœ‰ä¸€ç§ç®€å•çš„æ–¹æ³•ç±»ä¼¼äºæ’é˜Ÿçš„é¢†å·ï¼Œæ¯ä¸ªäººé¢†åˆ°çš„å·éƒ½ä¸ä¸€æ ·ã€‚</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// è·å–åŸç”Ÿçš„ window</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> nativeGlobal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Function</span></span><span class="token punctuation">(</span><span class="token string">'return this'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åœ¨ nativeGlobal ä¸Š é…ç½® __app_instance_name_map__, è¿™é‡Œè¿”å› __app_instance_name_map__</span>
<span class="token comment">// once: Creates a function that is restricted to invoking func once. Repeat calls to the function return the value of the first call. The func is invoked with the this binding and arguments of the created function.</span>
<span class="token comment">// see https://www.lodashjs.com/docs/lodash.once</span>
<span class="token comment">// app instance id generator compatible with nested sandbox</span>
<span class="token comment">// genAppInstanceIdByName åŒæ—¶è°ƒç”¨å¤šæ¬¡æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿèµ„æºäº‰å¤ºï¼Œåˆ©ç”¨é—­åŒ…è®©å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼Œç¼“å­˜æ‰§è¡Œçš„ç»“æœ</span>
<span class="token keyword">const</span> getGlobalAppInstanceMap <span class="token operator">=</span> once<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nativeGlobal<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'__app_instance_name_map__'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>nativeGlobal<span class="token punctuation">,</span> <span class="token string">'__app_instance_name_map__'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> nativeGlobal<span class="token punctuation">.</span>__app_instance_name_map__<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * æ ¹æ®å®ä¾‹åç§°è·å–å®ä¾‹ idï¼Œå†…éƒ¨è®¡æ•°è‡ªå¢
 * Get app instance name with the auto-increment approach
 * @param appName
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> genAppInstanceIdByName <span class="token operator">=</span> <span class="token punctuation">(</span>appName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// è·å–åˆ°åº”ç”¨å®ä¾‹ç¼“å­˜ map</span>
  <span class="token keyword">const</span> globalAppInstanceMap <span class="token operator">=</span> <span class="token function">getGlobalAppInstanceMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>appName <span class="token keyword">in</span> globalAppInstanceMap<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nativeGlobal<span class="token punctuation">.</span>__app_instance_name_map__<span class="token punctuation">[</span>appName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> appName<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  globalAppInstanceMap<span class="token punctuation">[</span>appName<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>appName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>globalAppInstanceMap<span class="token punctuation">[</span>appName<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="è·å–åŸç”Ÿçš„-window"><a href="#è·å–åŸç”Ÿçš„-window" class="header-anchor">#</a> è·å–åŸç”Ÿçš„ window</h2> <p><code>const window = new Function('return this')();</code>  å¯ä»¥è·å–åŸç”Ÿçš„ windowï¼Œè¿™é‡Œåˆ©ç”¨äº†æ„é€ å‡½æ•°åˆ›å»ºçš„ Function çš„ä¸€äº›ç‰¹æ€§ã€‚</p> <blockquote><p>ç”± Function æ„é€ å‡½æ•°åˆ›å»ºçš„å‡½æ•°ä¸ä¼šåˆ›å»ºå½“å‰ç¯å¢ƒçš„é—­åŒ…ï¼Œå®ƒä»¬æ€»æ˜¯è¢«åˆ›å»ºäºå…¨å±€ç¯å¢ƒï¼Œå› æ­¤åœ¨è¿è¡Œæ—¶å®ƒä»¬åªèƒ½è®¿é—®å…¨å±€å˜é‡å’Œè‡ªå·±çš„å±€éƒ¨å˜é‡ï¼Œä¸èƒ½è®¿é—®å®ƒä»¬è¢« Function æ„é€ å‡½æ•°åˆ›å»ºæ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸçš„å˜é‡ã€‚è¿™ä¸€ç‚¹ä¸ä½¿ç”¨ eval () æ‰§è¡Œåˆ›å»ºå‡½æ•°çš„ä»£ç ä¸åŒã€‚</p></blockquote> <p>å‚è€ƒï¼š</p> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function#function_%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%B8%8E%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%E4%B9%8B%E9%97%B4%E7%9A%84%E4%B8%8D%E5%90%8C" target="_blank" rel="noopener noreferrer">MDN: Function æ„é€ å‡½æ•°ä¸å‡½æ•°å£°æ˜ä¹‹é—´çš„ä¸åŒ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/jonsam-ng/fancy-front-end/edit/master/docs/30.web/6.qiankunæºç /10.core/20.loader.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2022/09/06, 14:25:16</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/qiankun/core/apis/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">æ ¸å¿ƒ API</div></a> <a href="/qiankun/core/effects/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Effects</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/qiankun/core/apis/" class="prev">æ ¸å¿ƒ API</a></span> <span class="next"><a href="/qiankun/core/effects/">Effects</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/solid/render/render-by-jsx/"><div>
            æ¸²æŸ“åŸç†ä¹‹ç»„ä»¶ç»“æ„ä¸ JSX ç¼–è¯‘
            <!----></div></a> <span class="date">09-07</span></dt></dl><dl><dd>02</dd> <dt><a href="/solid/plan/"><div>
            è®¡åˆ’è·Ÿè¸ª
            <!----></div></a> <span class="date">09-06</span></dt></dl><dl><dd>03</dd> <dt><a href="/solid/index/"><div>
            å¼€å§‹ä¸Šæ‰‹
            <!----></div></a> <span class="date">09-06</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:jonsam.ng@foxmail.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/jonsam-ng" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://www.jonsam.site" title="åšå®¢" target="_blank" class="iconfont icon-mao"></a><a href="https://docs.jonsam.site" title="æ–‡æ¡£" target="_blank" class="iconfont icon-shuben"></a><a href="https://ml.jonsam.site" title="æœºå™¨å­¦ä¹ " target="_blank" class="iconfont icon-code"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2022-2022
    <span>Fancy Front End | Made by <a href="https://www.jonsam.site" target="_blank">Jonsam</a> by â¤</span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----><div></div><!----><div></div><div></div></div></div>
    <script src="/assets/js/app.eb21b6ee.js" defer></script><script src="/assets/js/2.01e091c2.js" defer></script><script src="/assets/js/122.1452986d.js" defer></script><script src="/assets/js/4.54e60667.js" defer></script><script src="/assets/js/12.71337abb.js" defer></script><script src="/assets/js/10.ac472f43.js" defer></script><script src="/assets/js/11.c50183f9.js" defer></script><script src="/assets/js/8.7cbef5ec.js" defer></script><script src="/assets/js/5.f620477b.js" defer></script>
  </body>
</html>
